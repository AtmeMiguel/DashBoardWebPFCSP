@{
    ViewBag.Title = "Registrar Cuenta";
    Layout = "~/Views/Shared/_MasterExternoPagosPF.cshtml";
    string SERVIDOR = System.Configuration.ConfigurationManager.AppSettings["SERVIDOR"];
}


<style>


    .form-group-rc {
        /*      max-width: 300px;*/
        width: 80%;
        margin: auto;
    }

        .form-group-rc label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 16px;
        }

    .form-row-rc {
        display: flex;
        border: 1px solid #ccc;
        border-radius: 6px;
        overflow: hidden;
        background-color: #fff;
    }

    .select-rc {
        border: none;
        padding: 10px 12px;
        background-color: #fff;
        font-size: 15px;
        /*   appearance: none;*/
        border-right: 1px solid #ccc;
        width: 80px;
    }

    input[type="text"] {
        border: none;
        padding: 10px 12px;
        flex-grow: 1;
        font-size: 15px;
    }

    input:focus, select:focus {
        outline: none;
    }

    /* desplegables */

    /* contenedor recuperar contraseña */

    .account-content {
        width: 450px; /* Ancho del elemento */
        height: 700px; /* Alto del elemento */
        transform: rotate(0deg); /* Rotación en 0 grados */
        opacity: 1; /* Opacidad completa (sin transparencia) */
        position: absolute; /* Necesario para 'top' y 'left' */
        /*  top: 200px; Distancia desde la parte superior */
        /*   left: 840px; Distancia desde la parte izquierda */
        border-radius: 16px; /* Bordes redondeados */
        background-color: #FFFFFF33;
        top: 115px;
        left: 15px;
    }

    .account-text-titulo {
        font-family: 'Inter', sans-serif; /* Asumiendo que la fuente 'Inter Tight' está disponible */
        font-weight: 700; /* Negrita (Bold) */
        line-height: 32px;
        letter-spacing: 0;
        text-align: center;
        font-size: 27px;
        /* padding-left:21px;*/
    }


    .msgAlerta {
        font-family: 'Inter', sans-serif; /* Asegúrate de tener esta fuente disponible */
        font-weight: 200; /* Peso normal */
        font-style: normal; /* Estilo regular */
        font-size: 14px; /* Tamaño de la fuente */
        line-height: 24px; /* Altura de línea */
        letter-spacing: 0; /* Espaciado de letras */
        /*   font-size: 18px;
        margin-bottom: 15px;*/
        color: #FFEB3B;
        /*text-transform: lowercase;*/
        padding-top: 10px;
    }

    .enlacePol {
        font-family: 'Inter', sans-serif; /* Asegúrate de tener esta fuente disponible */
        font-weight: 300; /* Peso normal */
        font-style: normal; /* Estilo regular */
        font-size: 15px; /* Tamaño de la fuente */
        line-height: 24px; /* Altura de línea */
        letter-spacing: 0; /* Espaciado de letras */
        /*   font-size: 18px;
        margin-bottom: 15px;*/
        color: white;
        text-decoration:underline;
        /*text-transform: lowercase;*/
    }


    .cta-button-ini {
        font-family: 'Inter', sans-serif; /* Asumiendo que la fuente 'Inter Tight' está disponible */
        background-color: #ED6A00;
        border: none;
        color: white;
        padding: 12px 24px;
        cursor: pointer;
        font-size: 15px;
        border-radius: 15px;
    }


    /* Ocultando vector y otros*/
    .vector-botton-right {
        display: none;
    }

    .content-mobile {
        display: none;
    }

    .content1-btn-login {
        /* display: none;*/
        visibility: hidden;
    }

    /* media querys */
    @@media screen and (max-width: 768px) {

        .account-content {
            width: 100%; /* Ancho del elemento */
            top: 0;
            left: 0;
        }

        .hero-content2 {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .hero-content1 {
            display: none;
        }


        .content-mobile {
            display: none;
        }
    }

</style>
<div id="app">
    <div class="account-content">

        @*@using (Html.BeginForm("RecuperarCuenta", "Seguridad", FormMethod.Post, new { enctype = "multipart/form-data" }))
            {
            <form>*@

        <br /><br /><br />
        <p class="account-text-titulo">Registrate</p><br />

        <p style="font-size: 16px; text-align: left; padding-left: 0px; font-family: 'Inter', sans-serif;margin:auto;width:80%;font-weight:500;">1. Identificación de cliente</p>

        <p style="font-size: 15px; text-align: left; padding-left: 0px; padding-top: 9px; font-family: 'Inter', sans-serif; margin: auto; width: 80%; font-weight: 300;">Identificate ingresando los siguientes datos:</p><br />
        <br />

        <div class="form-group-rc">

            <label for="tipoDocumento" style="font-size: 13px; padding-bottom: 4px;padding-top:2px; text-align: left; padding-left: 0px; font-family: 'Inter', sans-serif; font-weight: 400;">Tipo documento</label>
            @*<div class="form-row-rc">*@

            <b-form-select id="tipoDocumento" name="tipoDocumento"
                           v-model="selectedDOC"
                           :options="optionsDOC" class="select-rc" style="line-height: initial; height: initial; width: 100%;border-radius:15px; "></b-form-select>
            <span class="msgAlerta" v-if="msgAlertaTipo != ''" style="width: 80%; text-align: center;"> <span v-if="msgAlertaTipo != ''" class="bi bi-exclamation-circle"></span>&nbsp;{{msgAlertaTipo}}</span>

            <label for="documento" style="font-size: 13px; padding-bottom: 4px; padding-top: 17px; text-align: left; padding-left: 0px; font-family: 'Inter', sans-serif; font-weight: 400;">Nro. de Documento</label>
            <b-form-input id="documento"
                          v-model="documento"
                          type="text"
                          placeholder="Ingrese número" style="border-radius:15px;"></b-form-input>
            <span class="msgAlerta" v-if="msgAlertaNro != ''" style="width: 80%; text-align: center;"> <span v-if="msgAlertaNro != ''" class="bi bi-exclamation-circle"></span>&nbsp;{{msgAlertaNro}}</span>

            <br />
            <br />
           
            <div>

                <b-link v-on:click="mostrarPoliticas()" class="enlacePol">Politicas de Privacidad de datos personales</b-link>
            </div>
            <br />
            <b-form-checkbox id="chkPoliticas"
                             v-model="estPoliticas"
                             name="chkPoliticas"
                             value="aceptado"
                             unchecked-value="no_aceptado" style="color:white; cursor:pointer;">
                Declaro haber leido los terminos y condiciones.
            </b-form-checkbox>
            
            @*</div>*@
            <span class="msgAlerta" v-if="estPoliticas == 'no_aceptado'" style="width: 80%; text-align: center;"> 
                 <span v-if="estPoliticas == 'no_aceptado'" class="bi bi-exclamation-circle"></span>
            &nbsp;Acepte terminos y condiciones</span>

        </div>

        <br />



        <div class="div-flex-center">
            <p class="msgAlerta" v-if="msgAlerta != ''" style="width: 80%; text-align: center;"><span v-if="msgAlerta != ''" class="bi bi-exclamation-circle"></span>&nbsp;{{msgAlerta}}</p>   @*@ViewBag.Message*@
        </div>

        <div class="div-flex-center" style="padding-top:10px;">

            <button class="cta-button-ini" style="width:80%;" v-on:click="paso1()" v-if="stateloader=='Comenzar'">Continuar</button>
            <button class="cta-button-ini" style="width:80%;" disabled v-if="stateloader=='Cargando'">Cargando...&nbsp;<b-spinner small></b-spinner></button>

        </div>


        @*</form>
            }*@
    </div>
    @*centered  hide-footer hide-header  *@
<b-modal id="mdPoliticas" centered size="lg" title="POLITICAS DE PRIVACIDAD DE DATOS PERSONALES"
         ok-title="Aceptar"
         cancel-title="Cancelar"
         ok-variant="custom-ok"
         cancel-variant="custom-cancel"
         header-class="custom-modal-header"
         data-html="true" @@hide="salida">
        
    <br />
    <p class="p-body-modal">1. Objetivo La presente política de privacidad de Datos Personales, tiene por finalidad informarle cómo las empresas / unidades de negocio del Grupo San Pablo</p>
    <p class="p-body-modal">2. Alcance La presente política aplica para todas las empresas/unidades de negocio del Grupo San Pablo: Operaciones y Proyectos Integrales (OPI), Red de Salud de Clínicas, Aranwa Hotels (Peruvian), Instituto Tecnológico, Inmobiliaria Magnopata, Tomomedic, Centro de Salud Ocupacional (CSO), Cardiomóvil (Servial),Laboratorios Qualab y Estacionamientos Templo, grupo empresarial que en adelante denominaremos Grupo San Pablo.</p>
    <br />
</b-modal>
</div>

<style scoped>


    
    /*botones modal*/

    .btn-custom-cancel {
        background-color: #ebebeb;
        /* border: 1px solid;*/
        color: black;
        /* box-shadow: none;*/
    }

        .btn-custom-cancel:hover {
            background-color: #d2d1d1;
        }

    .btn-custom-ok {
        background-color: #ED6A00;
     /*   border: none;*/
        color: white;
        /*box-shadow: none;*/
    }

        .btn-custom-ok:hover {
            color: white;
            background-color: #ba580a;
        }



    .custom-modal-header h5{
        color: #3f3f3f;
        font-family: 'Inter',sans-serif;
        font-size:25px;
        font-weight:300;
    }

    .p-body-modal {
        color: #3f3f3f; /* texto blanco */
        font-family: 'Inter',sans-serif;
        line-height: 25px;
    }

</style>

<script>

    var app = new Vue({
                el: '#app',
        data: {
                    //loader
                    stateloader: 'Comenzar',
                    disabledComenzar: true,
                    msgAlerta: '',
                    msgAlertaTipo: '',
            msgAlertaNro: '',
            msgAlertaPol: '',
            estPoliticas:'',
                    //documento identidad
                     selectedDOC: '0',
                    //{ text: 'Seleccione', value: '0' },
                      optionsDOC: [{ text: 'Seleccione', value: '0' },{ text: 'DNI', value: '1' }, { text: 'CE', value: '2' }],
                    //-----------------
                    indicador: false,
                    documento : '',
                    PAGINA: '@ViewBag.Title',
                    SITE: '',
                    ID: 0,
                    desFiltros: '',
                    canFilas: '0',

                    ACCION: '',
                    TITULO:'',

                    ListaSeleccionados:[],
                    ListaDocPago: [],

                    infoModal: {
                        id: 'info-modal',
                        title: '',
                        content: ''
                    }
                },
                mounted() {
                    estPoliticas: 'no_aceptado'
                },
        methods: {
                    ocultarPantalla: function (form) {
                        this.$bvModal.hide(form.PANTALLA);
                    },
                    pantalla: function (form) {
                        this.$bvModal.show(form.PANTALLA);
                    },
                    mostrarToast(variant = null) {
                        this.MensajeSistema = variant.msg;
                        this.$bvToast.toast(this.MensajeSistema, {
                            title: `Alerta de sistema`,
                            variant: variant.toast,
                            solid: true
                        })
                    },

                    agregar(item, index, button) {
                        this.Lista.push(item.ID);
                    },

                    editar(item, index, button) {
                        this.titulo = ''
                        this.vd_nroserie = ''

                        this.CONFIRMAR = '0'
                        this.GRUPO = ''
                        this.ENLACE = '';
                        if (item == 0) {
                           // this.ID = 0;
                            this.vd_nroserie = '';
                            this.vd_nrofactura = '';
                        } else {
                            //this.ID = item.ID;
                            //this.titulo = item.TITULO;
                            this.vd_nroserie = item.SNROFAC;
                            this.vd_nrofactura = item.DNROFAC;
                            this.vd_responsable = item.DRESP_CAB;
                            this.vd_estado = item.FLG_EST_DOC;
                        }
                        this.pantalla({ PANTALLA: 'VerDetalle' });
                    },
                    actualizar(item, index, button,accion,tipo) {
                        this.TITULO = ''
                        this.GRUPO = ''
                        this.ACCION = accion ;
                        this.ad_comentario = '';
                        this.ad_nroserie = '';
                        this.ad_nrofactura = '';
                        this.ad_idmasivo = '';
                        this.ad_mail = '';
                        this.ad_dnrolote = '';
                        if ((accion == 'APROBARM') || (accion == 'RECHAZARM')) {
                            var ListaDocPagoSeleccionados = this.ListaDocPago.filter(x => x.MARCADO == 'Seleccionado');

                            ListaDocPagoSeleccionados = ListaDocPagoSeleccionados.map(x => {
                               //+ '\'\''
                                return x.SNROFAC + '-' + x.DNROFAC ;

                            });
                            var can = ListaDocPagoSeleccionados.length;

                            this.ad_idmasivo = ListaDocPagoSeleccionados.join(',');

                            if (can==0) {
                                return;
                            }

                            if (accion == 'APROBARM') {
                                this.TITULO = 'Cantidad de facturas: ' + can + '.  ¿ESTA SEGURO DE APROBAR LAS FACTURAS NRO: ' + ListaDocPagoSeleccionados.join(' , ') + '?'
                            } else if (accion == 'RECHAZARM') {
                                this.TITULO = 'Cantidad de facturas: ' + can + '.  ¿SEGURO DE RECHAZAR LAS FACTURAS NRO: ' + ListaDocPagoSeleccionados.join(' , ') + '?'
                            }



                        } else {

                            if (item == 0) {

                            } else {
                                this.ad_nroserie = item.SNROFAC;
                                this.ad_nrofactura = item.DNROFAC;
                                this.ad_mail = item.MAIL;
                                this.ad_dnrolote = item.DNROLOTE;

                                if (accion == 'APROBAR') {
                                    this.TITULO = '¿ESTA SEGURO DE APROBAR LA FACTURA NRO: ' + this.ad_nroserie + '-' + this.ad_nrofactura + '?'
                                } else if (accion == 'RECHAZAR') {
                                    this.TITULO = '¿ESTA SEGURO DE RECHAZAR LA FACTURA NRO: ' + this.ad_nroserie + '-' + this.ad_nrofactura + '?'
                                }

                            }
                        }
                        this.pantalla({ PANTALLA: 'ActualizarDocPago' });
                    },
                    cerrarDetalle(nomModal) {
                        if (nomModal == 'VerDetalle') {
                            this.ocultarPantalla({ PANTALLA: 'VerDetalle' });
                        } else if (nomModal == 'ActualizarDocPago') {
                            this.ocultarPantalla({ PANTALLA: 'ActualizarDocPago' });
                        }

                    },
                    eliminar: function (item, index, button) {
                        this.infoModal.title = `Row index: ${index}`
                        this.infoModal.content = JSON.stringify(item, null, 2)
                        this.ID = item.ID;
                        this.$root.$emit('bv::show::modal', this.infoModal.id, button)
                    },
                    eliminarOk: function () {
                      },
                    salida: function () {
                        //this.listarDocPago();
                       // this.listarComunicados({ ID_GRUPO: this.ID_GRUPO, GRUPO: this.GRUPO });  // listarComunicados({ ID_GRUPO: item.ID, GRUPO: item.TITULO })
                    },
                    resetInfoModal() {
                        this.infoModal.title = '';
                        this.infoModal.content = '';
                    },
                    onFiltered(filteredItems) {
                        // Trigger pagination to update the number of buttons/pages due to filtering
                        this.totalRows = filteredItems.length;
                        this.currentPage = 1;
                    },

              mostrarPoliticas: function (item) {
                this.pantalla({ PANTALLA: 'mdPoliticas' });
            },
            paso1: function (item) {

                this.msgAlerta = '';
                this.msgAlertaTipo = '';
                this.msgAlertaNro = '';
                this.msgAlertaPol = '';
                var canErrores = 0;
            /*   alert(JSON.stringify(this.selectedDOC + '-' + this.documento + '-' + this.estPoliticas ));*/
                const tipoDoc = {
                            0: 'Seleccione',
                            1: 'DNI',
                            2: 'CARNET DE EXTRANGERIA'
                }

                var estadoDoc = '';
                var detalleFiltros = '';

                if (this.selectedDOC == '0') {

                    this.msgAlertaTipo = 'Seleccione tipo de documento.';
                    canErrores++;
                    if (this.documento.length == 0) {
                        this.msgAlertaNro = 'Ingrese nro. de documento.';
                        /*  return;*/
                        canErrores++;
                    }  
                }

                if (this.selectedDOC == '1') {

                    if (this.documento.length==0) {
                        this.msgAlertaNro = 'Ingrese número de DNI.';
                        canErrores++;
                      /*  return;*/
                    }else if (this.documento.length != 8) {
                        this.msgAlertaNro = 'DNI debe tener 8 digitos.';
                        canErrores++;
                       /* return;*/
                    }
                }

                if (this.selectedDOC == '2') {
                    if (this.documento.length == 0) {
                        this.msgAlertaNro = 'Ingrese carnet de extrangeria.';
                        canErrores++;
                       /* return;*/

                    } else if (this.documento.length != 9) {
                        this.msgAlertaNro = 'carnet de extrangeria debe tener 9 digitos.';
                        canErrores++;
                       /* return;*/
                    }
                }

                if (this.estPoliticas == '' || this.estPoliticas == 'no_aceptado') {
                    this.estPoliticas = 'no_aceptado';
                    canErrores++;
                }

                if (canErrores>0) {
                    return;
                }
               

                this.stateloader = 'Cargando';
                axios.post('@SERVIDOR' + '/api/Usuarios/GenerarEnlacePagPF', {
                    LLAVE_ORIGEN: this.documento,
                    TIPO_AUT: 'recuperar_cuenta',
                    TIPO_DOC: this.selectedDOC,
                    TIPO_ENV : 'correo'
                        }
                            //, { headers: { 'parSed': this.ID_SEDE } }
                        ).then(response => {
                            /*
                            detalleFiltros = 'FILTROS APLICADOS / ';
                            detalleFiltros = detalleFiltros + ' Estado : ' + estadoDoc + ' / ';
                            detalleFiltros = this.FEC_ESTADO_INI == '' ? detalleFiltros : detalleFiltros + 'Fecha cambio Estado Desde: ' + this.FEC_ESTADO_INI + ' / ';
                            detalleFiltros = this.FEC_ESTADO_FIN == '' ? detalleFiltros : detalleFiltros + 'Fecha cambio Estado Hasta: ' + this.FEC_ESTADO_FIN + ' / ';
                            detalleFiltros = this.FEC_INI == '' ? detalleFiltros : detalleFiltros + ' Fecha Lote desde : ' + this.FEC_INI + ' / ';
                            detalleFiltros = this.FEC_FIN == '' ? detalleFiltros : detalleFiltros + ' Fecha Lote hasta : ' + this.FEC_FIN + ' / ';
                            detalleFiltros = this.responsable == '' ? detalleFiltros : detalleFiltros + ' Responsable : ' + this.responsable + ' / ';
                            detalleFiltros = this.nroserie == '' ? detalleFiltros : detalleFiltros + ' Nro. Serie : ' + this.nroserie + ' / ';
                            detalleFiltros = this.nrofac == '' ? detalleFiltros : detalleFiltros + ' Correlativo : ' + this.nrofac + ' / ';

                            //-----
                            detalleFiltros = this.selectedFP == '' ? detalleFiltros : detalleFiltros + ' Forma Pago : ' + formaPago[this.selectedFP] + ' / ';
                            */

                        /*    this.desFiltros = detalleFiltros;*/
                            //this.ListaDocPago = response.data;
                            console.log(JSON.stringify(response.data));

                            if (response.data.MSG != 'OK') {
                                this.msgAlerta = response.data.MSG;
                            } else {
                                if (response.data.DETALLE_ENVIO=='OK') {
                                    this.msgAlerta = 'Se envio enlace al correo ' + response.data.DESTINATARIO;
                                }
                            }




                            //this.totalRows = this.ListaDocPago.length;
                            //this.canFilas = this.totalRows;
                            //this.indicador = false;
                            //this.renderChart();

                            this.stateloader = 'Comenzar';

                        }).catch(e => {
                            this.msgAlerta = 'Error en la conexión contacte con soporte...';
                        /*    this.mostrarToast({ toast: 'warning', msg: 'Error en la conexión ...' });*/
                            this.stateloader = 'Comenzar';
                        });

                    }

                }
    })
   /* app.generarEnlace();*/

</script>










