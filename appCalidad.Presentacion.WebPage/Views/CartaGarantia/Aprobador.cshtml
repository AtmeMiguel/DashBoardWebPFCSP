@{ string Title = "CARTA DE GARANTÍA";
    ViewBag.Title = Title;
    string apiServidor = System.Configuration.ConfigurationManager.AppSettings["API_SERVIDOR"];
    string webServidor = System.Configuration.ConfigurationManager.AppSettings["SERVIDOR"];
}

<div id="app">
    <div class="containerClaro">
        <br />
        <b-overlay :show="show" rounded="lg">

            <div class="row">
                <div class="col-xs-12 col-sm-12 col-lg-12" v-if="ID == 0">
                    <div class="row">
                        <div class="col-lg-3">
                            <div class="card redondoCardLight   shadow-lg">
                                <div class="card-body">
                                    <div class="row colorSanPablo">
                                        <div class="col-sm-8 col-md-8 col-lg-8">
                                            <div class="card-title  text-left text-white">
                                                <br /><h3>Gráfico de avance</h3>
                                            </div>
                                        </div>
                                        <div class="col-sm-4 col-md-4 col-lg-4">
                                            <div class="card-title  text-right text-white">
                                                <br /><span> <b-avatar button icon="bar-chart" size="3rem" variant="light"></b-avatar></span>
                                            </div>
                                        </div>
                                    </div>

                                    <h4 class="text-center">(semanal)</h4>
                                    <br />
                                    <template>
                                        <bar-chart :data="graficoAvance"></bar-chart>
                                    </template>
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-12 col-lg-9">
                            <div class="card redondoCardLight   shadow-lg">
                                <div class="card-body">

                                    <div class="row colorSanPablo">
                                        <div class="col-sm-8 col-md-8 col-lg-8">
                                            <div class="card-title  text-left text-white">
                                                <br /><h3>
                                                    MÉDICO AUDITOR
                                                </h3>
                                            </div>
                                        </div>
                                        <div class="col-sm-4 col-md-4 col-lg-4">
                                            <div class="card-title  text-right text-white">
                                                <br /><span> <b-avatar button icon="alarm" size="3rem" variant="light"></b-avatar></span><span>&nbsp;&nbsp;&nbsp;Tiempo: {{min}} : {{sec}}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-6 col-md-6 col-lg-6">
                                            <br /><br /><br /><br />
                                            <template v-for="item in ListaGeneral">
                                                <div class="row">
                                                    <div class="col-lg-6 text-center">

                                                        <b-avatar button icon="tags" v-on:click="pantalla({PANTALLA:'listaPendientes'})" variant="danger" title="Pendiente" class="align-center" size="4em"></b-avatar>
                                                        <br />Pendiente<br /><h4 class="align-center">{{item.PENDIENTE}}</h4>
                                                    </div>
                                                    <div class="col-lg-6 text-center">
                                                        <b-avatar button icon="tags" v-on:click="pantalla({PANTALLA:'graficoEstudios'})" variant="warning" title="Proceso" class="align-center" size="4em"></b-avatar>
                                                        <br />En proceso
                                                        <br />
                                                        <h4 class="align-center">{{item.PROCESO}}</h4>
                                                    </div>
                                                </div>
                                                <hr />
                                                <br />
                                                <br />
                                                <h4 class="text-center">Detalle de casos por Grupo</h4>
                                                <br />
                                                <br />

                                                <div class="row" v-for="e in item.ESTUDIOS">
                                                    <div class="col-lg-12 text-left">
                                                        <span><b-avatar button icon="diagram-3" variant="info" title="Pendiente" class="align-center" size="2em"></b-avatar>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="align-center">{{e.ESTUDIO}} - {{e.GRAFICA}}</span></span><br />
                                                    </div>
                                                </div>
                                            </template>
                                        </div>
                                        <div class="col-sm-6 col-md-6 col-lg-6">
                                            <br /><br /><br /><br /><br /><br />
                                            <h2>Bienvenido</h2>
                                            <br />
                                            <p>Tus talentos y habilidades irán mejorando con el tiempo, pero para eso has de empezar</p><br /><br />

                                            <div class="col-sm-6 col-md-10 col-lg-10 text-right">
                                                <template v-for="item in ListaGeneral">
                                                    <templat v-if="item.PENDIENTE > 0 || item.PROCESO > 0">
                                                        <b-button v-on:click="iniciar( { ID: 0, ID_SOURCE: 0, ID_GRUPO: 0 } )" variant="outline-info" pill><b-avatar variant="outline-info" icon="power" size="2rem"></b-avatar>Iniciar</b-button>
                                                </template>
                                            </div>
                                        </div>
                                    </div>


                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xs-12 col-sm-12 col-lg-12" v-else="ID == 0">
                    <div class="row">
                        <div class="col-lg-3">
                            <div class="card redondoCardLight  shadow-lg">
                                <div class="card-body reDimBox">
                                    <div class="row colorSanPablo">
                                        <div class="col-sm-12 col-md-12 col-lg-12">
                                            <div class="card-title  text-left text-white">
                                                <br /><h3>N° Carta: {{NUM_CARTA}}</h3>
                                            </div>
                                        </div>
                                    </div>
                                    <br />
                                    <template v-if="CONTRATO==''">
                                        <b-card no-body>
                                            <b-tabs pills card vertical>
                                                <b-tab title="N° Contrato" active>
                                                    <div class="row">
                                                        <div class="col-12"><br /><b-form-input v-model="TEXTO_BUSQUEDA" placeholder="Ingresar números" oninput="this.value = this.value.replace(/[^0-9.]/g, ''); this.value = this.value.replace(/(\..*)\./g, '$1');"></b-form-input></div>
                                                        <div class="col-12 text-right"><b-avatar button v-on:click="buscarPaciente({COMODIN: TEXTO_BUSQUEDA, TIPO: 1})" icon="search" size="3rem" variant="light"></b-avatar></div>
                                                    </div>
                                                </b-tab>
                                                <b-tab title="Doc. Identidad">
                                                    <div class="row">
                                                        <div class="col-12"><br /><b-form-input v-model="TEXTO_BUSQUEDA" placeholder="Ingresar números" oninput="this.value = this.value.replace(/[^0-9.]/g, ''); this.value = this.value.replace(/(\..*)\./g, '$1');"></b-form-input></div>
                                                        <div class="col-12 text-right"><b-avatar button v-on:click="buscarPaciente({COMODIN: TEXTO_BUSQUEDA, TIPO: 2})" icon="search" size="3rem" variant="light"></b-avatar></div>
                                                    </div>
                                                </b-tab>
                                                <b-tab title="Paciente">
                                                    <div class="row">
                                                        <div class="col-12"><br /><b-form-input v-model="TEXTO_BUSQUEDA" v-on:keyup="validaCampos(1)" placeholder="Ingresar letras"></b-form-input></div>
                                                        <div class="col-12 text-right"><b-avatar button v-on:click="buscarPaciente({COMODIN: TEXTO_BUSQUEDA, TIPO: 3})" icon="search" size="3rem" variant="light"></b-avatar></div>
                                                    </div>
                                                </b-tab>
                                            </b-tabs>
                                        </b-card>
                                    </template>

                                    <template v-if="CONTRATO!=''">
                                        <div class="row">
                                            <div class="col-12 text-center">
                                                <span><b>{{ASEGURADO}}</b></span><br />
                                                <span class="text-black-50" style="font-size:11px; ">Cod. Asegurado:{{COD_ASEGURADEP}}</span>
                                            </div>
                                        </div>
                                        <br />
                                        <span>Contratante: {{CONTRATANTE}}</span>
                                        <br />
                                        <span>Titular: {{TITULAR}}</span>
                                        <br />
                                        <span>N° Documento: {{NRO_DOCUMENTO}}</span>
                                        <br />
                                        <span>Promotor: {{PROMOTOR}}</span>
                                        <br />
                                        <br />
                                        <div class="row">
                                            <div class="col-7 text-left">
                                                <span>N° Contrato: <b>{{CONTRATO}}</b></span><br />
                                                <span class="text-black-50" style="font-size:11px;">Fecha vigencia: {{FEC_INIVIGSEG}}</span>
                                                <span class="text-black-50" style="font-size:11px;">Fecha registro: {{FEC_REGSEGURO}}</span>
                                            </div>
                                            <div class="col-5 text-right"><b-button pill variant="light">{{PLAN}}</b-button></div>
                                        </div>
                                        <br />
                                        <div class="text-right">
                                            <b-button variant="info" v-on:click="tabIndex-- ,listarCartasAprobadas()">
                                                CG Aprobadas(30 días) <b-badge variant="light">{{ListaCartasAprobadas.length}}</b-badge>
                                            </b-button>
                                            <b-button variant="info" v-on:click="tabIndex++ ,listarPrexistencias()">
                                                Prexistencias <b-badge variant="light">{{ListaPrexistencia.length}}</b-badge>
                                            </b-button>
                                        </div>
                                        <div class="row">
                                            <div class="col-xs-12 col-md-12 col-lg-12 cajaTexto">
                                                <span class="text-black-50 text-sm-right">Fecha de orden<b-badge v-if="FEC_HOSPITAL.length<4" pill variant="danger">!</b-badge></span><br />
                                                @*<b-form-input v-model="FECHA_NAC" :min="min" :max="max" class="cajaTexto2" :state="stateFecha_Nac" type="date" v-on:change="validaCampos(16)"></b-form-input>*@
                                                <b-form-datepicker id="datepicker-invalid" v-model="FEC_HOSPITAL"
                                                                   :max="max" locale="es" class="mb-2" readonly
                                                                   :show-decade-nav="false" :hide-header="false"
                                                                   :date-format-options="{ year: 'numeric', month: 'short', day: '2-digit', weekday: 'short' }"></b-form-datepicker>
                                            </div>

                                            <div class="col-xs-12 col-md-12 col-lg-12 cajaTexto">
                                                <span class="text-black-50 text-sm-right">Fecha Registro<b-badge v-if="FEC_SOLICITUD.length<4" pill variant="danger">!</b-badge></span><br />
                                                @*<b-form-input v-model="FECHA_NAC" :min="min" :max="max" class="cajaTexto2" :state="stateFecha_Nac" type="date" v-on:change="validaCampos(16)"></b-form-input>*@
                                                <b-form-datepicker id="datepicker-invalid2" v-model="FEC_SOLICITUD"
                                                                   :max="max" locale="es" class="mb-2" readonly
                                                                   :show-decade-nav="false" :hide-header="false"
                                                                   :date-format-options="{ year: 'numeric', month: 'short', day: '2-digit', weekday: 'short' }"></b-form-datepicker>
                                            </div>
                                        </div>
                                        <br />
                                        <div class="row">
                                            <div class="col-xs-12 col-md-12 col-lg-12 cajaTexto text-right text-info" style="padding-top:0.7rem;">
                                                Agregar una cobertura&nbsp;&nbsp;&nbsp;<b-avatar button v-on:click="COBERTURA='', listarCoberturas()" title="Elegir para ver la lista de coberturas" icon="search" size="2.0rem" variant="info"></b-avatar>
                                            </div>
                                            <template>
                                                <div class="accordion" role="tablist">
                                                    <b-card no-body class="mb-1" v-for="(ii, index) in listaCoberturasAgregadas">
                                                        <b-card-header header-tag="header" class="p-1">
                                                            <b-button block v-b-toggle.accordion-1 class="colorSanPablo">
                                                                <b-icon icon="trash" font-scale="1.3" variant="ligth" v-on:click="eliminarCoberturaAgregada({ID: ii.ID})"></b-icon>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                                {{ii.COBERTURA}}
                                                            </b-button>
                                                        </b-card-header>
                                                        <b-collapse id="accordion-1" visible accordion="my-accordion" role="tabpanel">
                                                            <b-card-body>
                                                                <b-card-text>
                                                                    Copago:&nbsp;&nbsp;<span style="font-size: 12px; line-height: 1;">{{ii.COPAGO}}</span>&nbsp;&nbsp;Deducible: &nbsp;&nbsp;<span class="text-black-50 text-lg-right" style="font-size: 12px; line-height: 1;">{{ii.DEDUCIBLE}}</span>
                                                                    <b-icon icon="pencil-square" font-scale="1.3" variant="ligth" v-on:click="ID_COBERTURA= ii.ID, COPAGO= ii.COPAGO, COBERTURA= ii.COBERTURA, DEDUCIBLE= ii.DEDUCIBLE,   editarCoberturaAgregada()"></b-icon>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                                </b-card-text>
                                                            </b-card-body>
                                                        </b-collapse>
                                                    </b-card>
                                                </div>
                                            </template>
                                        </div>
                                    </template>
                                </div>
                            </div>
                            <br />
                        </div>
                        <div class="col-xs-12 col-lg-9">
                            <div class="card redondoCardLight shadow-lg">
                                <div class="card-body reDimBox">
                                    <div class="row colorSanPablo">
                                        <div class="col-sm-8 col-md-8 col-lg-8">
                                            <div class="card-title  text-left text-white">
                                                <br /><h3>
                                                    {{SEDE}} @*{{ COD_EMPRESA}}{{COD_SUCURSAL}}*@   - GRUPO {{GRUPO}}
                                                </h3>
                                            </div>
                                        </div>
                                        <div class="col-sm-4 col-md-4 col-lg-4">
                                            <div class="card-title  text-right text-white">
                                                <br /><span> <b-avatar button icon="alarm" size="3rem" variant="light"></b-avatar></span><span>&nbsp;&nbsp;&nbsp;Tiempo: {{min}} : {{sec}}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <br />
                                    <div class="row" v-if="CONTRATO!=''">
                                        <div class="col-12">
                                            <b-alert :show="dismissCountDown" dismissible v-bind:variant="efecto" @@dismissed="dismissCountDown=0" @@dismiss-count-down="countDownChanged">
                                                <div v-if="BENECICIO_MAXIMO>0">
                                                    <p v-if="SALDO_CONSUMIR>0"><b>Saldo disponible:</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{SALDO_CONSUMIR}} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>Beneficio máximo:</b>  {{BENECICIO_MAXIMO}}.00</p>
                                                    <p v-else="SALDO_CONSUMIR>0"><b>Ajustar el límite de carta, para no superar el beneficio máximo de {{BENECICIO_MAXIMO}}, según su plan afiliado</b></p>
                                                </div>
                                                <div v-else="BENECICIO_MAXIMO>0"><p>El paciente dispone de  un beneficio  ilimitado, según su plan afiliado</p></div>
                                                <b-progress v-bind:variant="efecto" :max="BENECICIO_MAXIMO" :value="SALDO_CONSUMIR" height="5px"></b-progress>
                                            </b-alert>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-xs-12 col-md-4 col-lg-4 cajaTexto">
                                            <span class="text-black-50 text-sm-right">Médico tratante<b-badge v-if="MEDICO.length<10" pill variant="danger">!</b-badge></span> <br />
                                            <b-form-input v-model="MEDICO" class="cajaTexto2" readonly type="text" v-bind:title="MEDICO" v-on:keyup="CMP='', validaCampos(5)" placeholder="médico"></b-form-input>
                                        </div>
                                        <div class="col-xs-12 col-md-2 col-lg-2 cajaTexto">
                                            <span class="text-black-50 text-sm-right">CMP<b-badge v-if="CMP.length<3" pill variant="danger">!</b-badge></span> <br />
                                            <b-form-input v-model="CMP" class="cajaTexto2" readonly type="text" v-on:keyup="MEDICO=''" placeholder="CMP"></b-form-input>
                                        </div>

                                        <div class="col-xs-12 col-md-3 col-lg-3 cajaTexto">
                                            <span class="text-black-50 text-sm-right">Diagnóstico<b-badge v-if="DIAGNOSTICO.length<4" pill variant="danger">!</b-badge></span><br />
                                            <b-form-input v-model="DIAGNOSTICO" class="cajaTexto2" type="text" v-bind:title="DIAGNOSTICO" v-on:keyup="CIE='', validaCampos(5)" placeholder="Ingrese Diagnóstico"></b-form-input>
                                        </div>
                                        <div class="col-xs-12 col-md-1 col-lg-1 cajaTexto text-center" style="margin-top:15px;"><b-avatar v-if="DIAGNOSTICO.length>2 || CIE.length>2 " title="Ingrese min. 3 letras para buscar" button v-on:click="listarDiagnostico()" icon="search" size="2rem" variant="info"></b-avatar></div>
                                        <div class="col-xs-12 col-md-2 col-lg-2 cajaTexto">
                                            <span class="text-black-50 text-sm-right">CIE10<b-badge v-if="CIE.length<3" pill variant="danger">!</b-badge></span><br />
                                            <b-form-input v-model="CIE" class="cajaTexto2" type="text" v-on:keyup="DIAGNOSTICO='', validaCampos(7)" placeholder="Ingrese CIE 10"></b-form-input>
                                        </div>
                                    </div>

                                    <div class="row" v-if="CONTRATO!=''">
                                        <div class="col-xs-12 col-md-4 col-lg-2 cajaTexto">
                                            <span class="text-black-50 text-sm-right">Beneficio max.</span><br />
                                            <b-form-input v-model="BENECICIO_MAXIMO" readonly class="cajaTexto2" type="text"></b-form-input>
                                        </div>
                                        <div class="col-xs-12 col-md-6 col-lg-2 cajaTexto">
                                            <span class="text-black-50 text-sm-right">Siniestro Acum. BI</span><br />
                                            <b-form-input v-model="SINIESTRO_BI" readonly class="cajaTexto2" type="text" placeholder="0"></b-form-input>
                                        </div>
                                        <div class="col-xs-12 col-md-6 col-lg-2 cajaTexto">
                                            <span class="text-black-50 text-sm-right">Saldo por consumir</span><br />
                                            <b-form-input v-model="SALDO_CONSUMIR" readonly class="cajaTexto2" type="text" placeholder="0"></b-form-input>
                                        </div>
                                        <div class="col-xs-12 col-md-6 col-lg-2 cajaTexto">
                                            <span class="text-black-50 text-sm-right">Lím. GG<b-badge v-if="LIMITE_CG.length<1" pill variant="danger">!</b-badge></span><br />
                                            <b-form-input v-model="LIMITE_CG" class="cajaTexto2" type="text" readonly oninput="this.value = this.value.replace(/[^0-9.]/g, ''); this.value = this.value.replace(/(\..*)\./g, '$1');"></b-form-input>
                                            <b-form-invalid-feedback id="input-live-feedback">

                                                Debe contener solo números y punto decimal.
                                            </b-form-invalid-feedback>
                                        </div>
                                        <div class="col-xs-12 col-md-6 col-lg-2 cajaTexto">
                                            <span class="text-black-50 text-sm-right">Lím. GG Aprob.<b-badge v-if="LIM_CARTA_APROBADA.length<1" pill variant="danger">!</b-badge></span><br />
                                            <b-form-input v-model="LIM_CARTA_APROBADA" class="cajaTexto2" v-on:keyup="LIM_CARTA_APROBADA=0" v-on:click="verCuadrosAsociados(), $bvModal.show('solicitarCG')" type="tel" oninput="this.value = this.value.replace(/[^0-9.]/g, ''); this.value = this.value.replace(/(\..*)\./g, '$1');" onpaste="return false;"></b-form-input>   @*v-on:keyup="validaCampos(2)"*@
                                            <b-form-invalid-feedback id="input-live-feedback">
                                                Debe contener solo números y punto decimal.
                                            </b-form-invalid-feedback>
                                        </div>

                                        <div class="col-xs-12 col-md-6 col-lg-2 cajaTexto">
                                            <span class="text-black-50 text-sm-right">Complejidad carta<b-badge v-if="COMPLEJIDAD_CARTA == 'SELECCIONAR'" pill variant="danger">!</b-badge></span> <br />
                                            <b-form-input v-model="COMPLEJIDAD_CARTA" readonly class="cajaTexto2" type="text"></b-form-input>
                                        </div>
                                    </div>
                                    <div class="row" v-if="CONTRATO!=''">
                                        <div class="col-xs-12 col-md-2 col-lg-2 cajaTexto">
                                            <span class="text-black-50 text-sm-right">Área<b-badge v-if="AREA.length<3" pill variant="danger">!</b-badge></span> <br />
                                            <b-form-input v-model="AREA" readonly class="cajaTexto2" type="text"></b-form-input>
                                        </div>
                                        <div class="col-xs-12 col-md-4 col-lg-4 cajaTexto">
                                            <span class="text-black-50 text-sm-right">Plan de trabajo<b-badge v-if="PLAN_TRABAJO.length<5" pill variant="danger">!</b-badge></span> <br />
                                            <b-form-input v-model="PLAN_TRABAJO" v-bind:title="PLAN_TRABAJO" readonly class="cajaTexto2" type="text"></b-form-input>
                                        </div>
                                        <div class="col-xs-12 col-md-2 col-lg-2 cajaTexto">
                                            <span class="text-black-50 text-sm-right">Código<b-badge v-if="COD_TARIFARIO.length<2" pill variant="danger">!</b-badge></span><br />
                                            <b-form-input v-model="COD_TARIFARIO" readonly class="cajaTexto2" type="text"></b-form-input>
                                        </div>

                                        <div class="col-xs-12 col-md-4 col-lg-4 cajaTexto">
                                            <span class="text-black-50 text-sm-right">Procedimiento<b-badge v-if="PROCEDIMIENTO.length<3" pill variant="danger">!</b-badge></span><br />
                                            <b-form-input v-model="PROCEDIMIENTO" v-bind:title="PROCEDIMIENTO" readonly class="cajaTexto2" type="text"></b-form-input>
                                        </div>
                                    </div>
                                    <div class="row" v-if="CONTRATO!=''">
                                        <div class="col-xs-12 col-md-6 col-lg-6 cajaTexto">
                                            <span class="text-black-50 text-sm-right">Observación</span><br />
                                            <b-form-textarea id="textarea" v-model="OBSERVACION" placeholder="llenar Observación ..." rows="4" class="cajaTexto2" max-rows="6"></b-form-textarea>
                                        </div>
                                        <div class="col-xs-12 col-md-6 col-lg-6 cajaTexto">
                                            <span class="text-black-50 text-sm-right">Importante</span><br />
                                            <b-form-textarea id="textarea2" v-model="IMPORTANTE" placeholder="" rows="4" class="cajaTexto2" max-rows="6"></b-form-textarea>
                                        </div>
                                    </div>
                                    <div class="row" v-if="CONTRATO!=''">
                                        <div class="col-xs-12 col-md-6 col-lg-6 cajaTexto">
                                            <span class="text-black-50 text-sm-right">Observación interna</span><br />
                                            <b-form-textarea id="textarea3" v-model="OBSERVACION_INTERNA" placeholder="" rows="2" class="cajaTexto2" max-rows="6"></b-form-textarea>
                                        </div>
                                        <div class="col-xs-12 col-md-3 col-lg-3 cajaTexto">
                                            <span class="text-black-50 text-sm-right">Estado<b-badge v-if="ESTADO.length<5" pill variant="danger">!</b-badge></span> <br />
                                            <b-form-select v-model="ESTADO" class="cajaTexto2" v-on:change="cargarDropdow()">
                                                <template #first>
                                                    <b-form-select-option v-model="SELECCIONAR" value="null" disabled>SELECCIONAR</b-form-select-option>
                                                </template>
                                                <b-form-select-option v-for="i in ListaEstado" :key="i.ID" :value="i.TITULO">{{i.TITULO}}</b-form-select-option>
                                            </b-form-select>
                                        </div>
                                        <div v-if="ListaSubEstado.length>1" class="col-xs-12 col-md-3 col-lg-3 cajaTexto">
                                            <span class="text-black-50 text-sm-right">Sub Estado<b-badge v-if="SUB_ESTADO.length<5" pill variant="danger">!</b-badge></span> <br />
                                            <b-form-select v-model="SUB_ESTADO" class="cajaTexto2">
                                                <template #first>
                                                    <b-form-select-option v-model="SELECCIONAR" value="null" disabled>SELECCIONAR</b-form-select-option>
                                                </template>
                                                <b-form-select-option v-for="i in ListaSubEstado" :key="i.ID" :value="i.TITULO">{{i.TITULO}}</b-form-select-option>
                                            </b-form-select>
                                        </div>
                                    </div>


                                    <div class="row" v-if="CONTRATO!=''">
                                        <div class="col-xs-12 col-md-12 col-lg-12 text-right">
                                            <b-button-group>
                                                <span class="btn btn-link text-warning" style="width:70px" title="Derivar" v-on:click="Derivar()" v-if="ESTADO=='APROBADO' && LIM_CARTA_APROBADA>5000">
                                                    <span class="badge badge-light text-black-50" style="font-size: 11px; height: 12px; margin-top: -30px;  z-index: 10;"><b>Derivar</b></span>
                                                    <b-avatar title="Derivar" variant="outline-light" icon="person-up" size="5rem"></b-avatar>
                                                </span>
                                                <span class="btn btn-link text-black-50" style="width:70px" title="Adicional" v-on:click="pantalla({PANTALLA:'verAdicionales'})" v-if="ListaAdicionales.length>0">
                                                    <span class="badge badge-light text-black-50" style="font-size: 11px; height: 12px; margin-top: -30px;  z-index: 10;"><b>{{ListaAdicionales.length}}</b></span>
                                                    <b-avatar title="Adicional" variant="outline-light" icon="bookmarks" size="5rem"></b-avatar>
                                                </span>
                                                <span class="btn btn-link text-black-50" style="width:70px" title="Detalles" v-on:click="verDetalle()">
                                                    <span class="badge badge-light text-black-50" style="font-size: 11px; height: 11px; margin-top: -30px;  z-index: 10;">Detalles</span>
                                                    <b-avatar title="Archivo" variant="outline-light" icon="bookmarks" size="5rem"></b-avatar>
                                                </span>

                                                <span class="btn btn-link text-black-50" style="width:70px" title="Subir medio probatorio" v-on:click="pantallaExterna( {ID: ID_SOURCE, EXT: '.png'})">
                                                    <span class="badge badge-light text-black-50" style="font-size: 11px; height: 11px; margin-top: -30px;  z-index: 10;">Archivo</span>
                                                    <b-avatar title="Archivo" variant="outline-light" icon="file-image" size="5rem"></b-avatar>
                                                </span>

                                                <span class="btn btn-link text-black-50" style="width:70px" title="GNC" v-on:click="CAMPO='', pantalla({PANTALLA:'solicitarGNC'})">
                                                    <span class="badge badge-light text-black-50" style="font-size: 11px; height: 11px; margin-top: -30px;  z-index: 10;">GNC</span>
                                                    <b-avatar title="GNC" variant="outline-light" icon="ui-checks-grid" size="5rem"></b-avatar>
                                                </span>

                                                <span class="btn btn-link text-black-50" style="width:70px" title="Agendar revisión" v-on:click="pantalla({PANTALLA:'agendar'})">
                                                    <span class="badge badge-light text-black-50" style="font-size: 11px; height: 11px; margin-top: -30px;  z-index: 10;">Agendar</span>
                                                    <b-avatar variant="outline-light" icon="calendar3" size="5rem"></b-avatar>
                                                </span>
                                                <span class="btn btn-link text-black-50" style="width:70px" title="Guardar final" v-on:click="Guardar()">
                                                    <span class="badge badge-light text-black-50" style="font-size: 11px; height: 11px; margin-top: -30px;  z-index: 10;">Guardar</span>
                                                    <b-avatar variant="outline-light" icon="trophy" size="5rem"></b-avatar>
                                                </span>
                                            </b-button-group>
                                            <br /><br />
                                        </div>
                                    </div>



                                    <div class="row" v-if="CONTRATO!=''">
                                        <div class="col-sm-12 col-md-12 col-lg-12">
                                            <div class="card redondoCardLight   colorFondo" style="height: 500px;">
                                                <div class="card-body">
                                                    <div class="row" style=" margin-top: -10px; overflow: scroll; height: 500px; ">
                                                        <template v-for="(item, index) in ListaExpedientes">

                                                            <div class="col-xs-12 col-sm-12 col-lg-4">
                                                                <span class="btn btn-link text-dark" style="height: 250px; padding: 10px; cursor: zoom-in;">
                                                                    <span class="badge badge-light text-black-50" style="font-size: 8px; height: 10px; margin-top: -30px; margin-left: 20px; z-index: 10;">{{item.TITULO}}</span>
                                                                    <template v-if="item.EXT == '.pdf'">
                                                                        <img v-on:click="abrirPDF(URL + item.BANNER)" src="../Recursos/pdf.jpg" style="border-radius: 18px; object-fit: cover; " class="cajaGrisClaroDelgado" height="200px" width="100%">
                                                                    </template>
                                                                    <template v-else="item.EXT == '.pdf'">
                                                                        <img v-img v-bind:src="URL + item.BANNER" v-if="item.STATUS=='1'" class="cajaGrisClaroDelgado" style="border-radius: 18px; object-fit: cover; " height="200px" width="100%">
                                                                        <img v-img v-bind:src="URL + item.BANNER" v-if="item.STATUS=='0'" class="cajaRojoClaroDelgado" style="border-radius: 18px; object-fit: cover; filter: blur(0.4rem);" height="200px" width="100%">
                                                                    </template>

                                                                    <template v-if="item.STATUS== '1'">
                                                                        <span class="bg-light" style="position: relative; bottom: 60px; right: 0px; z-index: 10; padding: 15px; border-radius: 18px; ">
                                                                            <b-button-group>
                                                                                <span v-on:click="fileEliminar({ ID: item.ID, TITULO: item.TITULO, EXT: item.EXT, STATUS: 0, BANNER: item.BANNER })"> <img src="../icons/trash3.svg" style="height: 30px; width: 30px; "></span>
                                                                                <span style="padding-left:25px" v-on:click="fileDescargar({ID: item.ID, TITULO: item.TITULO, EXT: item.EXT, STATUS :1, URL: URL + item.BANNER, LABEL: item.TITULO + item.EXT, BANNER: item.BANNER })"> <img src="../icons/arrow-down-circle.svg" style="height: 30px; width: 30px; "></span>
                                                                            </b-button-group>
                                                                        </span>
                                                                    </template>
                                                                    <template v-if="item.STATUS== '0'">
                                                                        <span class="bg-danger" style="position: relative; bottom: 60px; right: 0px; z-index: 10; padding: 15px; border-radius: 18px; ">
                                                                            <b-button-group>
                                                                                <span v-on:click="fileEliminar({ ID: item.ID, TITULO: item.TITULO, EXT: item.EXT, STATUS: 1, BANNER: item.BANNER })"> <img src="../icons/arrow-repeat.svg" style="height: 30px; width: 30px; "></span>
                                                                                <span style="padding-left:25px" v-on:click="fileDescargar({ID: item.ID, TITULO: item.TITULO, EXT: item.EXT, STATUS :1, URL: URL + item.BANNER, LABEL: item.TITULO + item.EXT, BANNER: item.BANNER })"> <img src="../icons/arrow-down-circle.svg" style="height: 30px; width: 30px; "></span>
                                                                            </b-button-group>
                                                                        </span>
                                                                    </template>
                                                                </span>
                                                                <br />
                                                            </div>
                                                        </template>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </b-overlay>
    </div>

    <b-modal id="listaPendientes" size="xl" data-html="true" hide-footer hide-header @@hide="listarGraficoGeneral">
        <div class="row">
            <div class="col-sm-12 col-md-12">
                <div class="card redondoCardLight  cajaGrisClaroDelgado ">
                    <b-row style=" height: 550px; overflow: scroll; ">
                        <b-table :items="ListaPendiente"
                                 :fields="Columnas"
                                 stacked="md"
                                 head-variant="light"
                                 show-empty
                                 sticky-header
                                 small>
                            <template #cell(name)="row">
                                {{ row.value.first }} {{ row.value.last }}
                            </template>

                            <template #cell(ID)="row">
                                <b-avatar v-on:click="darPrioridad(row.item, row.index, $event.target)" title="dar prioridad" button icon="award" size="2rem" variant="light" class="align-center btn-outline-info"></b-avatar>
                            </template>
                        </b-table>
                    </b-row>
                </div>
            </div>
        </div>
    </b-modal>

    <b-modal id="graficoEstudios" size="xl" data-html="true" hide-footer hide-header @@hide="listarGraficoGeneral">
        <div class="row">
            <div class="col-sm-12 col-md-12">
                <div class="card redondoCardLight  cajaGrisClaroDelgado ">
                    <b-row style=" height: 550px; overflow: scroll; ">
                        <b-table :items="ListaProceso"
                                 :fields="Columnas"
                                 stacked="md"
                                 head-variant="light"
                                 show-empty
                                 sticky-header
                                 small>
                            <template #cell(name)="row">
                                {{ row.value.first }} {{ row.value.last }}
                            </template>

                            <template #cell(ID)="row">
                                <b-avatar v-on:click="darPrioridad(row.item, row.index, $event.target)" title="Dar prioridad" button icon="award" size="2rem" variant="light" class="align-center btn-outline-warning"></b-avatar>
                                <b-avatar v-if="row.item.ACCIONES!='GRUPO'" v-on:click="retirarPrioridad(row.item, row.index, $event.target)" title="No lo voy a atender" button icon="person-x" size="2rem" variant="light" class="align-center btn-outline-danger"></b-avatar>
                            </template>
                            <template #cell(ACCIONES)="row">

                                <b-badge v-if="row.item.ACCIONES =='PROCESO'" pill variant="warning">{{row.item.ACCIONES}}</b-badge>
                                <b-badge v-if="row.item.ACCIONES =='AGENDADO'" pill variant="info">{{row.item.ACCIONES}}</b-badge>
                                <b-badge v-if="row.item.ACCIONES =='GRUPO'" pill variant="dark">{{row.item.ACCIONES}}</b-badge>
                            </template>
                        </b-table>
                    </b-row>
                </div>
            </div>
        </div>
    </b-modal>

    <b-modal id="agendar" size="md" data-html="true" hide-footer hide-header>
        <div class="row">
            <div class="col-sm-12 col-md-12">
                <div class="card redondoCardLight  cajaGrisClaroDelgado ">
                    <div class="card-header colorSanPablo" style="float:right; font-size: 18px; height: 40px; margin-top: 0px;  z-index: 10;">
                        <div class="card-title text-center text-white">
                            <strong class="text-center">AGENDAR REGISTRO</strong>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="card-text">

                            <b-row>
                                <b-col cols="12" class="mb-3"></b-col>
                                <p>Value: <b>'{{ value }}'  '{{ hora }}'</b></p>
                            </b-row>

                            <b-row>
                                <b-col cols="8">
                                    <b-calendar v-model="value" :min="minH" :max="maxH" locale="es" :state="false" class="mb-2"></b-calendar>
                                </b-col>
                                <b-col cols="4">
                                    <b-form-timepicker v-model="hora"></b-form-timepicker>

                                    <br /><br /><br />
                                    <hr />
                                    <br /><br /><br /><br /><br />
                                    <div class="text-center">
                                        <b-avatar button icon="briefcase" v-on:click="GuardarAgendado()" variant="light" title="Agendar revisión" class="align-center" size="4em"></b-avatar><br /><h4 class="align-center">Guardar</h4>

                                    </div>
                                </b-col>

                            </b-row>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </b-modal>

    <b-modal id="nuevo" size="md" data-html="true" hide-footer hide-header>
        <div class="row">
            <div class="col-sm-12 col-md-12">
                <div class="card redondoCardLight  cajaGrisClaroDelgado ">
                    <div class="card-header bg-info" style="float:right; font-size: 18px; height: 40px; margin-top: 0px;  z-index: 10;">
                        <div class="card-title text-center text-white">
                            <strong class="text-center">LISTA DE ESTUDIOS</strong>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="card-text">
                            <template>
                                <p>Elige un grupo para empezar</p>
                                <br />
                                <div class="row">
                                    <div class="col-xs-6 col-md-6" v-for="i in ListaGruposxUsuario">
                                        <div class="bg-light">
                                            <b-avatar button icon="briefcase" v-on:click="configurar( { ID: 0, ID_SOURCE: 0, ID_GRUPO: i.ACCIONES } )" variant="info" title="Pendiente" class="align-center" size="4em"></b-avatar><br /><h4 class="align-center">{{i.TITULO}}</h4>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </b-modal>


    <b-modal id="solicitarMedico" size="xl" data-html="true" hide-footer hide-header>
        <div class="row">
            <div class="col-sm-12 col-md-12">
                <div class="card redondoCardLight  cajaGrisClaroDelgado ">
                    <div class="card-header colorSanPablo" style="float:right; font-size: 18px; height: 40px; margin-top: 0px;  z-index: 10;">
                        <div class="card-title text-center text-white">
                            <strong class="text-center">LISTA DE MÉDICOS</strong>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="card-text">
                            <div class="row">
                                <div class="col-xs-12 col-md-6 col-lg-6 cajaTexto">
                                    <p>Elige uno, para continuar</p>
                                </div>
                                <div class="col-xs-12 col-md-6 col-lg-6 cajaTexto">
                                    <b-form-input v-model="CAMPO" class="cajaTexto2" v-on:keyup="buscarMedico()" type="text"></b-form-input>
                                </div>
                            </div>
                            <div class="row">
                                <br /><br />
                                <div class="col-xs-4 col-md-4" v-for="i in listaMedicos">
                                    <div class="row">
                                        <div class="col-9 text-left">
                                            <span style="font-size:14px;">CMP: <b>{{i.CMP}}</b></span><br /><span style="font-size:11px;" class="text-black">{{i.MEDICO}}</span>
                                        </div>
                                        <div class="col-3 text-center">
                                            <b-avatar button icon="person-circle" variant="warning" title="Médico" class="align-center" size="4em" v-on:click="elegirMedico( { CMP: i.CMP, MEDICO: i.MEDICO } )"></b-avatar>
                                        </div>
                                    </div>
                                    <hr />
                                    @*<div class="bg-light">
                                            <b-avatar button icon="briefcase" v-on:click="configurar( { ID: 0, ID_SOURCE: 0, ID_GRUPO: i.ACCIONES } )" variant="info" title="Pendiente" class="align-center" size="4em"></b-avatar><h4 class="align-center">{{i.MEDICO}}</h4>
                                        </div>*@
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </b-modal>

    <b-modal id="solicitarCobertura" size="xl" data-html="true" hide-footer hide-header @@hide="CAMPO='', ID_COBERTURA='' ">
        <div class="row">
            <div class="col-sm-12 col-md-12">
                <div class="card redondoCardLight  cajaGrisClaroDelgado ">
                    <div class="card-header colorSanPablo" style="float:right; font-size: 18px; height: 40px; margin-top: 0px;  z-index: 10;">
                        <div class="card-title text-center text-white">
                            <strong class="text-center">LISTA DE COBERTURA</strong>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="card-text" v-if="COBERTURA==''">
                            <div class="row">
                                <div class="col-xs-12 col-md-6 col-lg-6 cajaTexto">
                                    <p>Elige uno, para continuar</p>
                                </div>
                                <div class="col-xs-12 col-md-6 col-lg-6 cajaTexto">
                                    <b-form-input v-model="CAMPO" class="cajaTexto2" v-on:keyup="buscarCobertura()" type="text"></b-form-input>
                                </div>
                            </div>
                            <div class="row">
                                <br />
                                <div class="col-xs-4 col-md-4" v-for="i in listaCoberturas">
                                    <div class="row">
                                        <div class="col-9 text-left">
                                            <span style="font-size:14px;"><b>{{i.COBERTURA}}</b></span><br />
                                            <span style="font-size:12px;">{{i.VIGENCIA}}</span>-<span style="font-size:11px;" class="text-black">{{i.CVALCOM}}</span><br />
                                            <span style="font-size:11px;" class="text-black">CoPago:&nbsp;{{i.COPAGO}}</span>&nbsp;&nbsp;&nbsp;<span v-if="i.DEDUCIBLE != '0'" style="font-size:11px;" class="text-black">Deducible:&nbsp;{{i.DEDUCIBLE}}</span>
                                        </div>
                                        <div class="col-3 text-center">
                                            <b-avatar button icon="prescription2" variant="warning" title="Cobertura" class="align-center" size="4em" v-on:click=" GRUPO_COBERTURA = i.GRUPO, COBERTURA = i.COBERTURA, COPAGO=i.COPAGO, DEDUCIBLE='', listaCoberturas = []"></b-avatar>
                                        </div>
                                    </div>
                                    <hr />
                                </div>
                            </div>
                        </div>
                        <div class="card-text" v-if="COBERTURA != ''">
                            <div class="row" v-if="listaCoberturas.length>0">
                                <div class="col-xs-12 col-md-12 col-lg-12 cajaTexto text-left text-info " style="padding-top:0.7rem;">
                                    Volver a visualizar coberturas&nbsp;&nbsp;&nbsp;<b-avatar button v-on:click=" listaCoberturas = listaCoberturas_" title="volver a visualizar coberturas" icon="arrow-repeat" size="2.5rem" variant="info"></b-avatar>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-xs-12 col-md-4 col-lg-2 cajaTexto reDim">
                                    <span class="text-black-50 text-sm-right">COPAGO (%)<b-badge v-if="COPAGO.length<1" pill variant="danger">!</b-badge></span><br />
                                    <b-form-input v-model="COPAGO" class="cajaTexto2" type="text"></b-form-input>
                                </div>
                                <div class="col-xs-12 col-md-6 col-lg-5 cajaTexto reDim">
                                    <span class="text-black-50 text-sm-right">Cobertura<b-badge v-if="COBERTURA.length<5" pill variant="danger">!</b-badge></span><br />
                                    <b-form-input v-model="COBERTURA" readonly class="cajaTexto2" type="text" v-bind:title="COBERTURA" placeholder="Cobertura"></b-form-input>
                                </div>
                                <div class="col-xs-12 col-md-4 col-lg-4 cajaTexto reDim">
                                    <span class="text-black-50 text-sm-right">Deducible<b-badge v-if="DEDUCIBLE.length<1" pill variant="danger">!</b-badge></span><br />
                                    <b-form-input v-model="DEDUCIBLE" class="cajaTexto2" type="text" placeholder="Deducible"></b-form-input>
                                    <b-form-invalid-feedback id="input-live-feedback">
                                        Debe contener minimo 2 digitos.
                                    </b-form-invalid-feedback>
                                </div>
                                <div class="col-xs-12 col-md-1 col-lg-1 cajaTexto text-left " style="padding-top:0.7rem;">
                                    <b-avatar button v-on:click=" elegirCobertura( { GRUPO: GRUPO_COBERTURA, COBERTURA: COBERTURA, COPAGO: COPAGO, DEDUCIBLE: DEDUCIBLE } )" title="Elegir una coberturas" icon="prescription2" size="2.5rem" variant="info"></b-avatar>
                                </div>
                            </div>
                            <div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </b-modal>

    <b-modal id="solicitarDiagnostico" size="xl" data-html="true" hide-footer hide-header>
        <div class="row">
            <div class="col-sm-12 col-md-12">
                <div class="card redondoCardLight  cajaGrisClaroDelgado ">
                    <div class="card-header colorSanPablo" style="float:right; font-size: 18px; height: 40px; margin-top: 0px;  z-index: 10;">
                        <div class="card-title text-center text-white">
                            <strong class="text-center">LISTA DE DIAGNOSTICOS</strong>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="card-text">
                            <div class="row">
                                <div class="col-xs-12 col-md-6 col-lg-6 cajaTexto">
                                    <p>Elige uno, para continuar</p>
                                </div>
                                <div class="col-xs-12 col-md-6 col-lg-6 cajaTexto">
                                    <b-form-input v-model="CAMPO" class="cajaTexto2" v-on:keyup="buscarDiagnostico()" type="text"></b-form-input>
                                </div>
                            </div>
                            <div class="row">
                                <br /><br />
                                <div class="col-xs-4 col-md-4" v-for="i in listaDiagnosticos">
                                    <div class="row">
                                        <div class="col-9 text-left">
                                            <span style="font-size:14px;">CIE10: <b>{{i.CIE}}</b></span><br /><span style="font-size:11px;" class="text-black">{{i.DIAGNOSTICO}}</span>
                                        </div>
                                        <div class="col-3 text-center">
                                            <b-avatar button icon="virus" variant="warning" title="Diagnostico" class="align-center" size="4em" v-on:click="elegirDiagnostico( { CIE: i.CIE, DIAGNOSTICO: i.DIAGNOSTICO } )"></b-avatar>
                                        </div>
                                    </div>
                                    <hr />
                                    @*<div class="bg-light">
                                            <b-avatar button icon="briefcase" v-on:click="configurar( { ID: 0, ID_SOURCE: 0, ID_GRUPO: i.ACCIONES } )" variant="info" title="Pendiente" class="align-center" size="4em"></b-avatar><h4 class="align-center">{{i.MEDICO}}</h4>
                                        </div>*@
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </b-modal>

    <b-modal id="solicitarProcedimiento" size="xl" data-html="true" hide-footer hide-header>
        <div class="row">
            <div class="col-sm-12 col-md-12">
                <div class="card redondoCardLight  cajaGrisClaroDelgado ">
                    <div class="card-header colorSanPablo" style="float:right; font-size: 18px; height: 40px; margin-top: 0px;  z-index: 10;">
                        <div class="card-title text-center text-white">
                            <strong class="text-center">LISTA DE PROCEDIMIENTOS</strong>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="card-text">
                            <div class="row">
                                <div class="col-xs-12 col-md-6 col-lg-6 cajaTexto">
                                    <p>Elige uno, para continuar</p>
                                </div>
                                <div class="col-xs-12 col-md-6 col-lg-6 cajaTexto">
                                    <b-form-input v-model="CAMPO" class="cajaTexto2" v-on:keyup="buscarProcedimiento()" type="text"></b-form-input>
                                </div>
                            </div>
                            <div class="row">
                                <br /><br />
                                <div class="col-xs-4 col-md-4" v-for="i in ListaProcedimiento">
                                    <div class="row">
                                        <div class="col-9 text-left">
                                            <span style="font-size:14px;">CÓDIGO: <b>{{i.COD_TARIFARIO}}</b></span><br /><span style="font-size:11px;" class="text-black">{{i.PROCEDIMIENTO}}</span>
                                        </div>
                                        <div class="col-3 text-center">
                                            <b-avatar button icon="heart-pulse" variant="warning" title="Diagnostico" class="align-center" size="4em" v-on:click="elegirProcedimiento( { COD_TARIFARIO: i.COD_TARIFARIO, PROCEDIMIENTO: i.PROCEDIMIENTO } )"></b-avatar>
                                        </div>
                                    </div>
                                    <hr />
                                    @*<div class="bg-light">
                                            <b-avatar button icon="briefcase" v-on:click="configurar( { ID: 0, ID_SOURCE: 0, ID_GRUPO: i.ACCIONES } )" variant="info" title="Pendiente" class="align-center" size="4em"></b-avatar><h4 class="align-center">{{i.MEDICO}}</h4>
                                        </div>*@
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </b-modal>

    <b-modal id="solicitarPrexistencia" size="xl" data-html="true" hide-footer hide-header>
        <div class="row">
            <div class="col-sm-12 col-md-12">
                <div class="card redondoCardLight   ">
                    <div class="card-header colorSanPablo" style="float:right; font-size: 18px; height: 40px; margin-top: 0px;  z-index: 10;">
                        <div class="card-title text-center text-white">
                            <strong class="text-center">INFORMACIÓN HISTORICA DEL AFILIADO</strong>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="card-text">
                            <!-- Tabs with card integration -->
                            <b-card no-body style=" margin-top: -10px; overflow: scroll; height: 450px; ">
                                <b-tabs v-model="tabIndex" small card>
                                    <b-tab title="Carta Garantía APROBADA" v-if="ListaCartasAprobadas.length>0">
                                        <div class="row text-left">
                                            <div class="col-12 cajaAmarilloPress" v-for="i in ListaCartasAprobadas" style="margin-bottom:10px;">
                                                <div class="row">
                                                    <div class="col-12 ">
                                                        <span><b>{{i.CIE10}}&nbsp;-&nbsp;{{i.DIAGNOSTICO}}</b></span><br />
                                                    </div>
                                                </div><hr />
                                                <div class="row">
                                                    <div class="col-6"><b>Plan de salud:</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{i.PLAN}}</div>
                                                    <div class="col-6">{{i.SEDE}}</div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-12"><b>Plan de trabajo:</b>&nbsp;&nbsp;&nbsp;{{i.PLAN_TRABAJO}}</div>
                                                    <div class="col-12">{{i.OBSERVACION}}</div>
                                                </div>
                                            </div>
                                            <br />
                                        </div>
                                    </b-tab>
                                    <b-tab title="Prexistencia" v-if="ListaPrexistencia.length>0">
                                        <div class="row text-left">
                                            <div class="col-12 cajaAmarilloPress" v-for="i in ListaPrexistencia" style="margin-bottom:10px;">
                                                <div class="row">
                                                    <div class="col-12 ">
                                                        <span><b>{{i.CIE_10}}&nbsp;-&nbsp;{{i.DIAGNOSTICO}}</b>&nbsp;&nbsp;&nbsp;&nbsp; CONDIC:{{i.CONDIC}}</span><br />
                                                    </div>
                                                </div>
                                                <br />
                                                <div class="row">
                                                    <div class="col-6">Fecha diagnostico: {{i.FECHA_DIAG}}</div>
                                                    <div class="col-6">{{i.CLINICA}}</div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-12">{{i.OBSERVACION}}</div>
                                                </div>
                                            </div>
                                            <br />
                                        </div>
                                    </b-tab>
                                </b-tabs>
                            </b-card>
                            <!-- Control buttons-->
                            <div class="text-center">
                                <b-button-group class="mt-2">
                                    <b-button @@click="tabIndex--">Anterior</b-button>
                                    <b-button @@click="tabIndex++">Siguiente</b-button>
                                </b-button-group>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </b-modal>

    <b-modal id="solicitarSede" size="md" data-html="true" hide-footer hide-header no-close-on-backdrop no-close-on-esc>
        <div class="row">
            <div class="col-sm-12 col-md-12">
                <div class="card redondoCardLight  cajaGrisClaroDelgado ">
                    <div class="card-header colorSanPablo" style="float:right; font-size: 18px; height: 40px; margin-top: 0px;  z-index: 10;">
                        <div class="card-title text-center text-white">
                            <strong class="text-center">LISTA DE CLÍNICAS</strong>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="card-text">
                            <div class="row">
                                <div class="col-xs-12 col-md-6 col-lg-6 cajaTexto">
                                    <p>Elige uno, para continuar</p>
                                </div>
                            </div>
                            <div class="row">
                                <br /><br />
                                <div class="col-xs-4 col-md-4 " v-for="i in ListaSedes">
                                    <div class="row colorSanPablo">
                                        <div class="col-12  " v-on:click="elegirSede( { COD_EMPRESA: i.CCOD_EMPRESA, COD_SUCURSAL: i.CCOD_SUCURSAL, SEDE: i.SEDE } )">
                                            <span style="font-size:14px; color:  white;"><b>{{i.SEDE}}</b></span>
                                        </div>
                                    </div>
                                    <hr />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </b-modal>

    <b-modal id="verAdicionales" size="lg" data-html="true" hide-footer hide-header>
        <div class="row">
            <div class="col-sm-12 col-md-12">
                <div class="card redondoCardLight  cajaGrisClaroDelgado ">
                    <div class="card-header colorSanPablo" style="float:right; font-size: 18px; height: 40px; margin-top: 0px;  z-index: 10;">
                        <div class="card-title text-center text-white">
                            <strong class="text-center">
                                DETALLE DE ADICIONALES
                            </strong>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="card-text">
                            <div class="row" style="padding:12px;">
                                <br />
                                <div>
                                    <b-row>
                                        <b-table :items="ListaAdicionales"
                                                 stacked="md" striped hover
                                                 head-variant="light"
                                                 show-empty
                                                 sticky-header
                                                 small>
                                            <template #cell(name)="row">
                                                {{ row.value.first }} {{ row.value.last }}
                                            </template>
                                        </b-table>
                                    </b-row>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </b-modal>

    <b-modal id="solicitarCartaDetalle" size="lg" data-html="true" hide-footer hide-header>
        <div class="row">
            <div class="col-sm-12 col-md-12">
                <div class="card redondoCardLight  cajaGrisClaroDelgado ">
                    <div class="card-header colorSanPablo" style="float:right; font-size: 18px; height: 40px; margin-top: 0px;  z-index: 10;">
                        <div class="card-title text-center text-white">
                            <strong class="text-center">
                                DETALLE DE ATENCIÓN CARTA {{NUM_CARTA}}
                            </strong>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="card-text">
                            <div class="row">
                                <br /><br />
                                <div class="col-xs-12 col-md-12 " v-for="i in ListaCartaDetalle">
                                    <div class="row colorSanPablo">
                                        <div class="col-12  ">
                                            <div>
                                                <span class="text-white">{{i.FECHA}} | {{i.ESTADO}} | {{i.USUARIO}} </span>&nbsp;&nbsp;&nbsp;&nbsp;<b-button v-b-toggle.collapse-1 variant="light">ver observación</b-button>&nbsp;&nbsp;&nbsp;&nbsp;<b-button v-b-toggle.collapse-2 variant="warning">ver LOG registro</b-button>
                                                <b-collapse id="collapse-1" class="mt-2">
                                                    <b-card>
                                                        <b-card>{{i.OBSERVACION}}</b-card>

                                                    </b-card>
                                                </b-collapse>
                                                <b-collapse id="collapse-2" class="mt-2">
                                                    <b-card>
                                                        <b-card>{{i.DETALLE}}</b-card>
                                                    </b-card>
                                                </b-collapse>
                                            </div>
                                        </div>
                                    </div>
                                    <hr />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </b-modal>

    <b-modal id="solicitarGNC" size="xl" data-html="true" hide-footer hide-header>
        <div class="row">
            <div class="col-sm-12 col-md-12">
                <div class="card redondoCardLight  cajaGrisClaroDelgado ">
                    <div class="card-header colorSanPablo" style="float:right; font-size: 18px; height: 40px; margin-top: 0px;  z-index: 10;">
                        <div class="card-title text-center text-white">
                            <strong class="text-center">LISTADO GNC</strong>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="card-text">
                            <div class="row">
                                <div class="col-xs-12 col-md-4 col-lg-4 cajaTexto">
                                    <p>Elija uno o varios items para continuar.</p>
                                </div>
                                <div class="col-xs-12 col-md-6 col-lg-6 cajaTexto">
                                    <b-form-input id="nuevoCampo" v-model="CAMPO" class="cajaTexto2" type="text"></b-form-input>
                                </div>
                                <div class="col-xs-12 col-md-2 col-lg-2 cajaTexto text-left ">
                                    <b-button size="sm" v-on:click="AgregarItem({idControl:8})" variant="warning" pill><b-avatar variant="outline-info" icon="plus-circle" size="2rem"></b-avatar>Agregar</b-button>
                                </div>
                            </div>
                            <div class="row">
                                <br /><hr /><br />
                                <div class="col-xs-4 col-md-4" v-for="i in ListaGNC">
                                    <div class="row">
                                        <div class="col-9 text-left">
                                            <span style="font-size:14px;"><b>{{i.TITULO}}</b></span><br />
                                        </div>
                                        <div class="col-3 text-center ">
                                            <b-avatar button icon="tag" v-if="i.STATUS==0" variant="light" title="GNC" class="align-center" size="4em" v-on:click="  AgregarListaGNC({ID: i.ID })"></b-avatar>
                                            <b-avatar button icon="tag" v-if="i.STATUS==1" variant="warning" title="GNC" class="align-center" size="4em" v-on:click="EliminarListaGNC({ID: i.ID })"></b-avatar>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </b-modal>

    <b-modal id="solicitarCG" size="xl" data-html="true" hide-footer hide-header no-close-on-backdrop no-close-on-esc>
        <div class="row">
            <div class="col-sm-12 col-md-12">
                <div class="card redondoCardLight  cajaGrisClaroDelgado ">
                    <div class="card-header colorSanPablo" style="float:right; font-size: 18px; height: 40px; margin-top: 0px;  z-index: 10;">
                        <div class="card-title text-center text-white">
                            <strong class="text-center">LISTADO CUADROS ASOCIADOS</strong>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="card-text">
                            <div class="row">
                                <div class="col-xs-12 col-md-5 col-lg-5 cajaTexto">
                                    <h5>Elija uno o varios cuadros asociados para continuar.</h5>
                                </div>
                                <div class="col-xs-12 col-md-5 col-lg-5 cajaTexto ">
                                    <b-form-input id="nuevoCampo" v-model="CAMPO" class="cajaTexto2" type="text"></b-form-input>
                                </div>
                                <div class="col-xs-12 col-md-2 col-lg-2 cajaTexto text-left ">
                                    <b-button size="sm" v-on:click="AgregarItem({idControl:9})" variant="warning" pill><b-avatar variant="outline-info" icon="plus-circle" size="2rem"></b-avatar>Agregar</b-button>
                                    <br />
                                </div>
                            </div>
                            <br />
                            <div class="row">
                                <br />
                                <div class="col-xs-4 col-md-4" v-for="i in ListaCuadrosAsociados" v-if="i.VALUE<=0">
                                    <div class="row">
                                        <div class="col-6 text-left">
                                            <span style="font-size:14px;"><b>{{i.TITULO}}</b></span><br />
                                        </div>
                                        <div class="col-4 text-center ">
                                            <b-form-input id="nuevoCampo" v-model="i.VALUE_" class="cajaTexto2" type="text" oninput="this.value = this.value.replace(/[^0-9.]/g, ''); this.value = this.value.replace(/(\..*)\./g, '$1');" maxlength="6" required=""></b-form-input>
                                        </div>
                                        <div class="col-2 text-center " v-if="i.VALUE_>0">
                                            <b-button size="sm" v-on:click="i.VALUE=i.VALUE_, i.STATUS=1, AdmCuadrosAsociados(i)" variant="warning" pill><b-avatar variant="outline-info" icon="plus-circle" size="2rem"></b-avatar></b-button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <hr />
                            <h5>Lista de cuadros seleccionados</h5>
                            <div class="row">
                                <div class="col-xs-12 col-md-6">
                                    <div class="row">
                                        <div class="col-xs-12 col-lg-12" v-for="i in ListaCuadrosAsociados" v-if="i.VALUE>0">
                                            <div class="row">
                                                <div class="col-6 text-left">
                                                    <span style="font-size:14px;"><b>{{i.TITULO}}</b></span><br />
                                                </div>
                                                <div class="col-4 text-center ">
                                                    <span style="font-size:14px;">s/. {{i.VALUE}}</span><br />
                                                    @*<b-form-input id="nuevoCampo" v-model="i.VALUE" class="cajaTexto2" type="text" oninput="this.value = this.value.replace(/[^0-9]/g, ''); this.value = this.value.replace(/(\..*)\./g, '$1');" maxlength="3" required=""></b-form-input>*@
                                                </div>
                                                <div class="col-2 text-center ">
                                                    <b-button size="sm" v-on:click="i.VALUE='0' ,i.VALUE_='0', i.STATUS=0, AdmCuadrosAsociados(i)" variant="danger" pill><b-avatar variant="outline-info" icon="trash" size="2rem"></b-avatar></b-button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xs-12 col-md-6">
                                    <div class="row">
                                        <div class="col-6 text-right">
                                            <br />
                                            <h5>{{LIMITE_CG}}</h5>
                                            <h5>{{LIM_CARTA_DIFERENCIA}}</h5>
                                            <hr />
                                            <h5>{{LIM_CARTA_APROBADA}}</h5>
                                        </div>
                                        <div class="col-6 text-left text-black-50">
                                            <br />
                                            <p>Límite de carta</p>
                                            <p>Cuadros asociados </p>
                                            <hr />
                                            <p>Límite de carta aprobada</p>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div class="row">
                                <div class="col-12 text-right">
                                    <br />
                                    <b-button class="mt-3" block @@click="$bvModal.hide('solicitarCG')">Cerrar</b-button>

                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </b-modal>

    <b-modal id="ImageCarta" size="xl" data-html="true" hide-footer hide-header @@hide="cargarExpedientes">
        <div class="col-xs-12">
            <b-embed type="iframe"
                     aspect="16by9"
                     v-bind:src="SITE"
                     allowfullscreen></b-embed>
        </div>
    </b-modal>
</div>
<script>

    const configImg = {
            headers: { Authorization: `Bearer ${'@Session["Token"].ToString()'}` }
        };

    const now = new Date()
    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate())
    // 15th two months prior
    const minDate = new Date(today)
    minDate.setDate(minDate.getDate())
    //minDate.setDate(15)
    // 15th in two months
    const maxDate = new Date(today)
    maxDate.setMonth(maxDate.getMonth() + 1)
    //maxDate.setDate(15)
    const maxDate15 = new Date(today)
    maxDate15.setDate(maxDate15.getDate() + 20)


    var app = new Vue({
        el: '#app',
        data: {
            ID_USUARIO: '@User.Identity.Name',
            SERVER_URL: sessionStorage.getItem('SERVER_URL'),
            SERVER_API: '@apiServidor',

            ID_SEDE: '@Session["ID_SEDE"].ToString()',
            SEDE: '@Session["SEDE"].ToString()',
            ROL: '@Session["ROL"].ToString()',
            USUARIO: '@Session["USUARIO"].ToString()',
            ID_GRUPO: sessionStorage.getItem('IMAGE'),
            GRUPO: '',
            GRUPO_COBERTURA: '',
            URL: '@webServidor',
            PLANTILLA: '',
            ID: 0,
            ID_FILE: 0,
            ID_SOURCE: 0,
            TXT_OBSERVACION: '',
            SELECCIONAR: 'SELECCIONAR',
            TEXTO_BUSQUEDA: '',
            COD_EMPRESA: '',
            COD_SUCURSAL: '',
            SEDE: '',

            NUM_CARTA: '',
            CONTRATO: '',
            PROMOTOR: '',
            CONTRATANTE: '',
            NRO_DOCUMENTO: '',
            ASEGURADO: '',
            FEC_INIVIGSEG: '',
            FEC_REGSEGURO: '',
            PLAN: '',
            COD_PLAN: '',
            TITULAR: '',
            COD_ASEGURADEP: '',
            ID_COBERTURA: '',

            MEDICO: '',
            DIAGNOSTICO: '',
            FEC_HOSPITAL: '',
            FEC_SOLICITUD: '',
            LIMITE_CG: '0',
            LIM_CARTA_APROBADA: '0',
            LIM_CARTA_DIFERENCIA: '0',
            SINIESTRO_BI: '0',
            SALDO_CONSUMIR: '0',
            efecto: 'info',
            COBERTURA: '',
            COPAGO: '',
            DEDUCIBLE: '',
            AREA: 'SELECCIONAR',
            PLAN_TRABAJO: 'SELECCIONAR',
            MOTIVO: 'SELECCIONAR',
            PROCEDIMIENTO: '',
            COD_TARIFARIO: '',
            OBSERVACION: '',
            OBSERVACION_INTERNA: '',
            NRO_DOCUMENTO: '',
            CMP: '',
            CIE: '',
            ESTADO: 'SELECCIONAR',
            SUB_ESTADO: 'SELECCIONAR',
            FECHA_ATENCION: '',
            COMPLEJIDAD_CARTA: '',
            IMPORTANTE: '',
            AUTORIZADO: 0,
            MODULOS: [],
            CAMPOS: {},
            CAMPO: '',
            SITE: '',
            show: false,
            value: [],
            currentTime: 1,
            min: 0,
            max: minDate,
            sec: 0,
            CONTAR: false,
            context: '',
            value: '',
            hora: '09:00',
            minH: minDate,
            maxH: maxDate,
            INC: 0,
            tabIndex: 1,
            SEC_CONTRATO : '',
            graficoAvance: [],
            ListaGruposxUsuario: [],
            ListaItem: [],
            ListaSedes: [],
            ListaGeneral: [],
            ListaProceso: [],
            ListaExpedientes: [],
            listaAfiliados: [],
            ListaArea: [],
            ListaPlanTrabajo: [],
            ListaMotivo: [],
            listaMedicos: [],
            listaMedicos_: [],
            listaDiagnosticos: [],
            listaDiagnosticos_: [],
            listaCoberturas: [],
            listaCoberturas_: [],
            listaCoberturasAgregadas: [],
            ListaProcedimiento: [],
            ListaProcedimiento_: [],
            ListaComplejidad: [],
            ListaCartaDetalle: [],
            ListaEstado: [],
            ListaSubEstado: [],
            ListaPendiente: [],
            ListaGNC: [],
            ListaCuadrosAsociados: [],
            ListaGNCCheck: [],
            ListaAdicionales: [],
            ListaPrexistencia: [],
            ListaCartasAprobadas: [],
            Columnas: ['ID', 'TITULO', 'ACCIONES', 'FECHA'],
            dismissSecs: 3600,
            dismissCountDown: 0,
        },
        computed: {
            availableOptions() {
                return this.options.filter(opt => this.value.indexOf(opt) === -1)
            }
        },
        methods: {
            mostrarToast(variant = null) {
                this.$bvToast.toast(variant.msg, {
                    title: `Alerta de sistema`,
                    variant: variant.toast,
                    solid: true
                })
            },
            countDownChanged(dismissCountDown) {
                this.dismissCountDown = dismissCountDown
            },
            showAlert() {
                this.dismissCountDown = this.dismissSecs
            },

            updateCurrentTime() {
                if (this.currentTime > 0 && this.currentTime < 3600000 && this.CONTAR == true) {
                    setTimeout(() => {
                        this.currentTime += 1
                        this.min = Math.trunc((this.currentTime) / 60) % 60;
                        this.min = this.min > 9 ? this.min : '0' + this.min;
                        this.sec = Math.trunc((this.currentTime)) % 60;
                        this.sec = this.sec > 9 ? this.sec : '0' + this.sec;
                        this.updateCurrentTime()
                    }, 1000)
                }
            },

            pantallaExterna: function (item) {
                this.SITE = './ImagenCarta/?idSource=' + item.ID + '&idUsuario=' + this.ID_USUARIO;
                this.$bvModal.show('ImageCarta');
            },

            elegirAfiliado: function (it) {
                this.GRUPO = it.GRUPO;
                this.CONTRATO = it.CONTRATO;
                this.COD_ASEGURADEP = it.COD_ASEGURADEP;
                this.ASEGURADO = it.ASEGURADO;
                this.CONTRATANTE = it.CONTRATANTE;
                this.TITULAR = it.TITULAR;
                this.PROMOTOR = it.PROMOTOR;

                this.PLAN = it.PLAN;
                this.FEC_REGSEGURO = it.FEC_REGSEGURO;
                this.listaAfiliados = [];
            },

            listarDiagnostico: function () {
                if (this.CIE.length > 2 || this.DIAGNOSTICO.length > 2) {
                    let tipo = (this.CIE.length > 2) ? 0 : 1;
                    axios.post(this.SERVER_API + '/api/CartaGarantia/ListarDiagnosticos', {
                        CIE: this.CIE,
                        DIAGNOSTICO: this.DIAGNOSTICO,
                        TIPO: tipo,
                    }, configImg).then(response => {
                        if (response.data.length > 0) {
                            this.listaDiagnosticos = response.data;        //alert(JSON.stringify(lista));
                            this.listaDiagnosticos_ = response.data;
                            this.$bvModal.show('solicitarDiagnostico');
                        } else {
                            this.mostrarToast({ toast: 'warning', msg: 'No encontramos información ...' });
                        }
                    }).catch(e => { });
                }
            },

            buscarDiagnostico: function (item) {
                if (this.CAMPO.length > 0) {
                    let palabra = this.CAMPO.toUpperCase();
                    this.listaDiagnosticos = this.listaDiagnosticos_.filter(x => {
                        return x.CAMPO_BUSQUEDA.includes(palabra);
                    });
                }
                else {
                    this.listaDiagnosticos = this.listaDiagnosticos_;
                }
            },

            elegirDiagnostico: function (item) {
                this.CIE = item.CIE;
                this.DIAGNOSTICO = item.DIAGNOSTICO;
                this.listaDiagnosticos = [];
                this.listaDiagnosticos_ = [];
                this.CAMPO = '';
                this.stateDiagnostico = true;
                this.$bvModal.hide('solicitarDiagnostico');
            },

            listarMedico: function () {
                if (this.CMP.length > 2 || this.MEDICO.length > 2) {
                    let tipo = (this.CMP.length > 2) ? 0 : 1;
                    axios.post(this.SERVER_API + '/api/CartaGarantia/listarMedicos', {
                        CMP: this.CMP,
                        MEDICO: this.MEDICO,
                        TIPO: tipo,
                    }, configImg).then(response => {
                        if (response.data.length > 0) {
                            this.listaMedicos = response.data;        //alert(JSON.stringify(lista));
                            this.listaMedicos_ = response.data;
                            //alert(JSON.stringify(this.listaMedicos_));
                            this.$bvModal.show('solicitarMedico');
                        } else {
                            this.mostrarToast({ toast: 'warning', msg: 'No encontramos información ...' });
                        }
                    }).catch(e => { });
                }
            },

            buscarMedico: function () {
                if (this.CAMPO.length > 0) {
                    let palabra = this.CAMPO.toUpperCase();
                    this.listaMedicos = this.listaMedicos_.filter(x => {
                        return x.CAMPO_BUSQUEDA.includes(palabra);
                    });
                }
                else {
                    this.listaMedicos = this.listaMedicos_;
                }
            },

            elegirMedico: function (item) {
                this.CMP = item.CMP;
                this.MEDICO = item.MEDICO;
                this.listaMedicos = [];
                this.listaMedicos_ = [];
                this.CAMPO = '';
                this.stateMedico = true;
                this.$bvModal.hide('solicitarMedico');
            },

            validaCampos(item) {
                switch (item) {
                    case 1: {
                        this.TEXTO_BUSQUEDA = this.TEXTO_BUSQUEDA.toUpperCase();
                        break;
                    }
                    case 2: {
                        this.stateLimiteCG = false;
                        this.stateDeducible = false;
                        this.stateLimiteCG = this.LIMITE_CG.length < 2 ? false : true;
                        this.stateDeducible = this.DEDUCIBLE.length < 2 ? false : true;
                        break;
                    }
                    case 3: {
                        this.stateArea = false;
                        this.statePlanTrabajo = false;
                        this.stateMotivo = false;

                        this.stateArea = this.AREA != 'SELECCIONAR' ? true : false;
                        this.statePlanTrabajo = this.PLAN_TRABAJO != 'SELECCIONAR' ? true : false;
                        this.stateMotivo = this.MOTIVO != 'SELECCIONAR' ? true : false;
                        break;
                    }


                    case 4: {
                        // this.stateApeMaterno = this.APE_MATERNO.length < 2 ? false : true; this.APE_MATERNO = this.APE_MATERNO.toUpperCase(); break;
                        if (/^[a-zA-ZÁÉÍÓÚáéíóúñÑ ]+$/.test(this.APE_MATERNO)) {

                            if (this.APE_MATERNO != null) {
                                if (this.APE_MATERNO.trim().length < 3) {

                                    this.stateApeMaterno = false;
                                } else {
                                    this.APE_MATERNO = this.APE_MATERNO.toUpperCase();
                                    this.stateApeMaterno = true;
                                }
                            }
                        } else {
                            //this.APE_MATERNO = '';
                            this.stateApeMaterno = false;
                        }
                        break;
                    }
                    case 5: {
                        this.MEDICO = this.MEDICO.toUpperCase();
                        this.DIAGNOSTICO = this.DIAGNOSTICO.toUpperCase();
                        this.PROCEDIMIENTO = this.PROCEDIMIENTO.toUpperCase();
                        break;
                    }

                    case 6: {
                        this.stateFecHospital = false;
                        this.stateFecSolicitud = false;
                        this.stateFecHospital = this.FEC_HOSPITAL != null ? true : false;
                        this.stateFecSolicitud = this.FEC_SOLICITUD != null ? true : false;
                        break;
                    }
                    case 7: {
                        this.CIE = this.CIE.toUpperCase();
                        break;
                    }


                }
                //this.validarFormulario();
            },

            //onclick="window.open(URL + PLANTILLA + '/' + item.BANNER, '_blank', 'location=yes,height=570,width=520,scrollbars=yes,status=yes');"
            abrirPDF: function (url) {
                // Abrir nuevo tab
                var win = window.open(url, '_blank', 'location=yes,height=570,width=520,scrollbars=yes,status=yes');
                // Cambiar el foco al nuevo tab (punto opcional)
                win.focus();
            },

            pantalla: function (item) {
                this.$bvModal.show(item.PANTALLA);
            },

            configurar: function (item) {
                this.show = true;
                axios.post(this.SERVER_URL + '/api/Formulario/Mantenimiento', {
                    ID: item.ID,
                    ID_SOURCE: item.ID_SOURCE,
                    ID_GRUPO: item.ID_GRUPO,
                    ID_SEDE: this.ID_SEDE,
                    ID_USUARIO: this.ID_USUARIO,
                    TIPO: 30,
                }, configImg).then(response => {
                    if (response.data.ID > 0) {
                        this.show = false;
                        this.$bvModal.hide('nuevo');
                        this.iniciar();
                    }
                }).catch(e => {
                });
            },
            //MODIFICADO ML                         //   alert(JSON.stringify(response.data));
            iniciar: async function () {
                this.show = true;
                await axios.post(this.SERVER_API + '/api/Grupo/IniciarQueuexGrupoSede', {
                    ID: 0,
                    ID_SOURCE: 0,
                    ID_GRUPO: 18,
                    ID_SEDE: this.ID_SEDE,
                    ID_USUARIO: this.ID_USUARIO
                }, configImg).then(response => {
                    if (response.data.ID > 0) {
                        this.show = false;
                        if (this.CONTAR == false) { this.CONTAR = true; this.updateCurrentTime(); }
                        this.PLANTILLA = response.data.PLANTILLA;
                        this.ID = response.data.ID;
                        this.ID_SOURCE = response.data.ID_SOURCE;
                        this.ID_GRUPO = response.data.ID_GRUPO;
                        this.cargarRegistro();
                        this.verAdicionales();
                    }
                }).catch(e => {
                });
            },

            cargarRegistro: async function () {
                this.SINIESTRO_BI = '0';
                this.SALDO_CONSUMIR = '0';
                await axios.post(this.SERVER_API + '/api/CartaGarantia/ListarCarta', {
                    ID:         this.ID_SOURCE,
                    ID_USUARIO: this.ID_USUARIO,
                    USUARIO:    this.USUARIO,
                    ID_SEDE:    this.ID_SEDE,
                }, configImg).then(response => {
                    if (response.data.ID > 0) {
                            this.cargarExpedientes();
                            this.listarCoberturasAgregadas();
                        if (response.data.NUMCONTRATOPF != null) {
                            this.NUM_CARTA = response.data.NUM_CARTA;
                            this.GRUPO = response.data.GRUPO;

                            this.CONTRATO = response.data.NUMCONTRATOPF;
                            this.PROMOTOR = response.data.PROMOTOR;
                            this.CONTRATANTE = response.data.CONTRATANTE;
                            this.NRO_DOCUMENTO = response.data.NRO_DOCUMENTO;
                            this.ASEGURADO = response.data.AFILIADO;
                            this.FEC_INIVIGSEG = response.data.FEC_VIG_AFILIACION;
                            this.FEC_REGSEGURO = response.data.FEC_INI_AFILIACION;
                            this.COD_ASEGURADEP = response.data.COD_ASEGURADEP;
                            this.TITULAR = response.data.CONTRATANTE;
                            this.PLAN = response.data.DSC_PLAN;
                            this.COD_PLAN = response.data.COD_PLAN;
                            this.MEDICO = response.data.MEDICO_TRATANTE == null ? '' : response.data.MEDICO_TRATANTE;
                            this.DIAGNOSTICO = response.data.DIAGNOSTICO == null ? '' : response.data.DIAGNOSTICO;
                            this.FEC_HOSPITAL = response.data.FEC_HOSPITALIZACION == null ? '' : response.data.FEC_HOSPITALIZACION;
                            this.FEC_SOLICITUD = response.data.FEC_SOLICITUD == null ? '' : response.data.FEC_SOLICITUD;
                            this.LIMITE_CG = response.data.LIM_CARTA == null ? 0 : response.data.LIM_CARTA;
                            //this.LIM_CARTA_APROBADA = 0; // response.data.LIM_CARTA_APROBADA == null ? 0 : response.data.LIM_CARTA_APROBADA;
                            this.BENECICIO_MAXIMO = response.data.BENECICIO_MAXIMO == null ? 0 : response.data.BENECICIO_MAXIMO;

                            this.verCuadrosAsociados();

                            this.AREA = response.data.AREA == null ? 'SELECCIONAR' : response.data.AREA;
                            this.PLAN_TRABAJO = response.data.PLAN_TRABAJO == null ? 'SELECCIONAR' : response.data.PLAN_TRABAJO;
                            this.MOTIVO = response.data.DSC_MOTIVO == null ? 'SELECCIONAR' : response.data.DSC_MOTIVO;
                            this.PROCEDIMIENTO = response.data.PROCEDIMIENTO1 == null ? '' : response.data.PROCEDIMIENTO1;
                            this.COD_TARIFARIO = response.data.CODPROC1 == null ? '' : response.data.CODPROC1;
                            this.OBSERVACION = response.data.OBSERVACION;
                            this.OBSERVACION_ = response.data.OBSERVACION_;
                            this.OBSERVACION_INTERNA = response.data.OBSERVACION_INTERNA;
                            this.CMP = response.data.CMP == null ? '' : response.data.CMP;
                            this.CIE = response.data.CIE == null ? '' : response.data.CIE;
                            this.COD_EMPRESA = response.data.COD_EMPRESA == null ? '00' : response.data.COD_EMPRESA;
                            this.COD_SUCURSAL = response.data.COD_SUCURSAL == null ? '00' : response.data.COD_SUCURSAL;
                            this.SEDE = response.data.SEDE == null ? '' : response.data.SEDE;
                            this.COMPLEJIDAD_CARTA = response.data.COMPLEJIDAD_CARTA == null ? 'SELECCIONAR' : response.data.COMPLEJIDAD_CARTA;
                            this.ESTADO = 'SELECCIONAR';
                            this.IMPORTANTE = response.data.IMPORTANTE == null ? '' : response.data.IMPORTANTE;
                            this.SEC_CONTRATO = response.data.SEC_CONTRATO == null ? '' : response.data.SEC_CONTRATO;
                            this.AUTORIZADO = response.data.AUTORIZADO == null ? '0' : response.data.AUTORIZADO;
                            this.verSiniestros();
                            this.listarPrexistencias();
                            this.listarCartasAprobadas();
                        }
                    } else {
                        document.location.href = '../CartaGarantia/Aprobador';
                    }
                }).catch(e => {
                    alert('Ocurrio un error' + e);
                });
            },



            verSiniestros: async function () {
                let calculo = 0;
                this.SINIESTRO_BI = '0';
                this.SALDO_CONSUMIR = this.BENECICIO_MAXIMO;
                        await axios.post(this.SERVER_API + '/api/CartaGarantia/ListarSiniestroBI', {
                            ID: this.ID,
                            ID_USUARIO: this.ID_USUARIO,
                            USUARIO: this.USUARIO,
                            NUMCONTRATOPF: this.CONTRATO.replace(' ', ''),
                            NRO_DOCUMENTO: this.NRO_DOCUMENTO.replace(' ', ''),
                        }, configImg).then(response => {
                            if (response.data.SINIESTRO_BI > 0) {
                                this.SINIESTRO_BI = response.data.SINIESTRO_BI;
                                this.SALDO_CONSUMIR = (parseFloat(this.BENECICIO_MAXIMO) - parseFloat(this.SINIESTRO_BI) - parseFloat(this.LIM_CARTA_APROBADA)).toFixed(2);
                                calculo = (parseFloat((this.SALDO_CONSUMIR * 100) / this.BENECICIO_MAXIMO)).toFixed(0);
                                this.efecto = calculo > 50 ? "success" : calculo > 25 ? "warning" : calculo > 0 ? "danger" : "danger";
                            } else {
                                this.SALDO_CONSUMIR = (parseFloat(this.BENECICIO_MAXIMO) - parseFloat(this.LIM_CARTA_APROBADA)).toFixed(2);
                                calculo = (parseFloat((this.SALDO_CONSUMIR * 100) / this.BENECICIO_MAXIMO)).toFixed(0);
                                this.efecto = calculo > 50 ? "success" : calculo > 25 ? "warning" : calculo > 0 ? "danger" : "danger";
                            }
                        }).catch(e => {
                            this.efecto = "light";
                            this.mostrarToast({ toast: 'warning', msg: 'No encontramos información ...' });
                        });

                this.showAlert();
            },

            //MODIFICADO ML
            cargarExpedientes: async function () {
                this.ListaExpedientes = [];
                await axios.post(this.SERVER_API + '/api/CartaGarantia/ListarArchivosxCarga', {
                    ID_SOURCE: this.ID_SOURCE,
                    ID_USUARIO: this.ID_USUARIO,
                    USUARIO: this.USUARIO,
                }, configImg).then(response => {
                    this.ListaExpedientes = response.data;
                }).catch(e => {
                });
            },

            doShow: function (field) {
                if (this.CAMPOS[field].if != undefined) {
                    let listaIf = this.CAMPOS[field].if
                    //alert(JSON.stringify(listaIf));
                    for (i in listaIf) {
                        let valor = listaIf[i].object;
                        let valor2 = listaIf[i].igual;
                        let campo = listaIf[i].value;
                        if (this.CAMPOS[valor].value != valor2) {
                            this.CAMPOS[campo].VALIDAR = 0;
                            return false;
                        } else { this.CAMPOS[campo].VALIDAR = 1; }
                    }
                }
                return true;
            },
            //MODIFICADO ML
            Guardar: function () {
                let msg = 'Verificar los siguientes campos: ';
                msg = this.DIAGNOSTICO == '' ? msg + " Diagnostico" : msg;
                msg = this.CIE == '' ? msg + " CIE 10" : msg;
                msg = this.LIM_CARTA_APROBADA == '' ? msg + " Límite de carta aprobada" : msg;
                msg = Number(this.LIM_CARTA_APROBADA) < 9 ? msg + " Límite de carta de garantía" : msg;
                msg = this.listaCoberturasAgregadas.length == 0 ? msg + " Agregar cobertura" : msg;

                msg = this.ESTADO == 'SELECCIONAR' ? msg + " Estado" : msg;
                if (this.ListaSubEstado.length > 1) {
                    msg = this.SUB_ESTADO == 'SELECCIONAR' ? msg + " Sub Estado" : msg;
                }
                let calculo = this.BENECICIO_MAXIMO>0 ? (parseFloat(this.BENECICIO_MAXIMO) - parseFloat(this.SINIESTRO_BI) - parseFloat(this.LIM_CARTA_APROBADA)).toFixed(2) : 1;
                msg = calculo > 0 ? msg : msg + 'Saldo disponible superado, verificar límite de carta aprobado';
                    if (msg.length > 34) {
                        this.mostrarToast({ toast: 'danger', msg: msg });
                        return 0;
                    } else {
                        this.GuardarProceso({ STATUS: 3 });
                    }
            },

            Derivar: function () {    // MODIFICADO
                this.ESTADO = 'RECIBIDO';
                this.SUB_ESTADO = '';
                let msg = 'Verificar los siguientes campos: ';
                msg = this.DIAGNOSTICO == '' ? msg + " Diagnostico" : msg;
                msg = this.CIE == '' ? msg + " CIE 10" : msg;
                msg = this.LIM_CARTA_APROBADA == '' ? msg + " Límite de carta aprobada" : msg;
                msg = Number(this.LIM_CARTA_APROBADA) < 9 ? msg + " Límite de carta de garantía" : msg;
                msg = this.listaCoberturasAgregadas.length == 0 ? msg + " Agregar cobertura" : msg;

                msg = this.ESTADO == 'SELECCIONAR' ? msg + " Estado" : msg;
                if (this.ListaSubEstado.length > 1) {
                    msg = this.SUB_ESTADO == 'SELECCIONAR' ? msg + " Sub Estado" : msg;
                }
                let calculo = this.BENECICIO_MAXIMO > 0 ? (parseFloat(this.BENECICIO_MAXIMO) - parseFloat(this.SINIESTRO_BI) - parseFloat(this.LIM_CARTA_APROBADA)).toFixed(2) : 1;
                msg = calculo > 0 ? msg : msg + 'Saldo disponible superado, verificar límite de carta aprobado';

                if (msg.length > 34) {
                    this.mostrarToast({ toast: 'danger', msg: msg });
                    return 0;
                } else {
                    this.GuardarProceso({ STATUS: 3 });
                }
            },

            //MODIFICADO ML
            GuardarAvance: function () {    // MODIFICADO
                let msg = 'Verificar los siguientes campos: ';
                this.ESTADO = 'RECIBIDO';
                this.SUB_ESTADO = '';
                this.GuardarProceso( { STATUS: 2} );
            },

            GuardarAgendado: function () {    // MODIFICADO
                if (this.hora.length > 2 && this.value != '') {
                    this.show = true;
                    let CAMPOS = '';
                    let Plan = '';
                    this.ESTADO = 'PROCESO AUDITORIA';
                    this.SUB_ESTADO = '';
                    let val = (this.value + ' ' + this.hora.slice(0, 5));
                    this.GuardarProceso({ STATUS: 6, TITULO: val });
                } else { this.mostrarToast({ toast: 'warning', msg: 'Verificar fecha y hora ...' }); }
            },

            //MODIFICADO ML
            GuardarProceso: async function (item) {  // 33 - 39
                let monto = this.LIM_CARTA_APROBADA.replace('.', ',');
                let sinBI = this.SINIESTRO_BI.replace('.', ',');
                //let sinCG = this.SINIESTRO_CG.replace('.', ',');
                if (this.ListaSubEstado.length > 1) {
                } else {
                    this.SUB_ESTADO = '';
                }
                this.show = true;
                await axios.post(this.SERVER_API + '/api/CartaGarantia/AprobarCarta', {
                    ID: this.ID_SOURCE,
                    ID_USUARIO: this.ID_USUARIO,
                    COD_EMPRESA: this.COD_EMPRESA,
                    COD_SUCURSAL: this.COD_SUCURSAL,
                    USUARIO: this.USUARIO,
                    SEDE: this.SEDE,

                    CIE: this.CIE,
                    DIAGNOSTICO: this.DIAGNOSTICO,
                    LIM_CARTA_APROBADA: monto,

                    PLAN_TRABAJO: this.PLAN_TRABAJO == 'SELECCIONAR' ? 'SELECCIONAR' : this.PLAN_TRABAJO  ,
                    PROCEDIMIENTO1: this.PROCEDIMIENTO,
                    CODPROC1: this.COD_TARIFARIO,
                    OBSERVACION: this.OBSERVACION,
                    OBSERVACION_INTERNA: this.OBSERVACION_INTERNA,
                    STATUS: item.STATUS,

                    ESTADO: this.ESTADO,
                    SUB_ESTADO: this.SUB_ESTADO,
                    COMPLEJIDAD: this.COMPLEJIDAD_CARTA,
                    IMPORTANTE: this.IMPORTANTE,
                    SINIESTRO_BI: sinBI,
                    ID_SEDE: this.ID_SEDE,
                    AUTORIZADO: this.AUTORIZADO,
                }, configImg).then(response => {
                    if (response.data.V_ID > 0) {
                        axios.post(this.SERVER_URL + '/api/Formulario/MantenimientoQUEUE', {
                            ID: this.ID,
                            ID_SOURCE: this.ID_SOURCE,
                            TITULO: item.TITULO,
                            ID_SEDE: this.ID_SEDE,
                            ID_GRUPO: this.ID_GRUPO,
                            ID_USUARIO: this.ID_USUARIO,
                            P_MENSAJE: item.CAMPOS,
                            TIPO: item.STATUS,
                        }).then(response => {
                            if (response.data.ID > 0) {
                                document.location.href = '../CartaGarantia/Aprobador';
                            } else {
                                this.show = false;
                                this.mostrarToast({ toast: 'warning', msg: response.data.RESULTADO });
                            }

                        }).catch(e => {
                        });
                    } else {
                        this.mostrarToast({ toast: 'warning', msg: response.data.RESULTADO });
                        this.show = false;
                    }

                }).catch(e => {
                    this.mostrarToast({ toast: 'warning', msg: 'Ocurrio un error no controlado, verifique que todos los campos fueron ingresados correctamente, verifique que el campo observación no sea muy extenso  ' });
                    this.show = false;
                });
            },

            test: function (item) {
                let valor = item.value;
                if (valor != undefined) {
                    let idPadre = 0; let lista = item.options;
                    for (i in lista) {
                        let listaItem = this.ListaItem.filter(x => x.ID_USUARIO == lista[i].id);
                        if (listaItem.length > 0) {
                            for (var obj in this.CAMPOS) {
                                if (`${this.CAMPOS[obj].COLUMNA}` == listaItem[0].PLANTILLA) {    //alert(nuevoControl);
                                    this.CAMPOS[obj].options = [];
                                    this.CAMPOS[obj].VALIDAR = 0;
                                }
                            }
                        }
                        if (lista[i].value == valor) idPadre = lista[i].id;
                    }
                    let listaItem = this.ListaItem.filter(x => x.ID_USUARIO == idPadre);
                    if (listaItem.length > 0) {
                        let nuevoControl = listaItem[0].PLANTILLA;
                        for (var obj in this.CAMPOS) {
                            if (`${this.CAMPOS[obj].COLUMNA}` == nuevoControl) {    //alert(nuevoControl);
                                this.CAMPOS[obj].options = [];
                                this.CAMPOS[obj].VALIDAR = 0;
                                let item = [];

                                for (var ite in listaItem) {
                                    item.push({ id: listaItem[ite].ID, idControl: listaItem[ite].ID_GRUPO, text: listaItem[ite].TITULO, value: listaItem[ite].TITULO });
                                    this.CAMPOS[obj].value = listaItem[ite].TITULO;
                                    this.CAMPOS[obj].VALIDAR = 1;
                                }
                                if (`${this.CAMPOS[obj].type}` == 'multi') {
                                    this.CAMPOS[obj].value = [];
                                }
                                this.CAMPOS[obj].options = item;
                            }
                        }
                    }
                }
            },
            //MODIFICADO ML
            fileDescargar: function (item) {
                axios.get(item.URL, { responseType: 'blob' })
                    .then(response => {
                        const blob = new Blob([response.data], { type: 'application/pdf' })
                        const link = document.createElement('a')
                        link.href = URL.createObjectURL(blob)
                        link.download = item.LABEL
                        link.click()
                        URL.revokeObjectURL(link.href)
                        this.fileChange({ ID: item.ID, STATUS: 1, TITULO: item.TITULO, EXT: item.EXT, BANNER: item.BANNER });
                    }).catch(console.error)
            },
            //MODIFICADO ML
            fileEliminar: function (item) {
                this.fileChange({ ID: item.ID, STATUS: item.STATUS, TITULO: item.TITULO, EXT: item.EXT, BANNER: item.BANNER });
            },
            //MODIFICADO ML
            fileChange: function (item) {
                this.show = true;
                axios.post(this.SERVER_API + '/api/CartaGarantia/EliminarArchivo', {
                    ID_FILE: item.ID,
                    ID_USUARIO: this.ID_USUARIO,
                    STATUS: item.STATUS,
                }, configImg).then(response => {
                    if (response.data.V_ID > 0) {
                        this.show = false;
                        this.ListaExpedientes = this.ListaExpedientes.filter(x => x.ID != item.ID);
                        this.ListaExpedientes.push({ ID: item.ID, TITULO: item.TITULO, EXT: item.EXT, PESO: 0, IP_USUARIO: '', FECHA: '', STATUS: item.STATUS, BANNER: item.BANNER });
                        this.ListaExpedientes.sort((a, b) => (a.ID > b.ID) ? 1 : ((b.ID > a.ID) ? -1 : 0));
                    } else {
                        this.show = false;
                        this.mostrarToast({ toast: 'warning', msg: 'Ocurrio un error ...' });
                    }
                }).catch(e => {
                });
            },

            grafico: function () {
                this.graficoAvance = [];
                axios.post(this.SERVER_API + '/api/Usuario/ListarUsuariosxCarga_T', {
                    ID: this.ID_USUARIO,
                    ID_SEDE: this.ID_SEDE,
                }, configImg).then(response => {
                    if (response.data.length > 0) {
                        let lista1 = response.data;
                        let columnas = {};
                        for (let tajada1 in lista1) {
                            columnas[`${lista1[tajada1].FECHA}`] = `${lista1[tajada1].ID}`; //  alert(JSON.stringify(`${lista[items].ESTADO}`));
                        }
                        this.graficoAvance = columnas;
                    }
                }).catch(e => { this.mostrarToast({ toast: 'warning', msg: 'Error en la conexión ...' }); });
            },

            //MODIFICADO ML
            listarGruposxUsuario: function () {   // MODIFICADO
                //this.show = true;
                axios.post(this.SERVER_API + '/api/Grupo/ListarGruposxPrograma', {
                    ID: this.ID_USUARIO,
                    ID_USUARIO: this.ID_USUARIO,
                    ID_SEDE: this.ID_SEDE,
                }, configImg).then(response => {
                    if (response.data.length > 0) { this.ListaGruposxUsuario = response.data; }
                }).catch(e => { this.mostrarToast({ toast: 'warning', msg: 'Error en la conexión ...' }); });
            },
            //MODIFICADO ML
            listarGraficoGeneral: function () {    // MODIFICADO
                this.ListaGeneral = []; this.graficoGeneral = []; this.graficoAvance2 = []; this.ListaProceso = []; this.ListaPendiente = [];
                axios.post(this.SERVER_API + '/api/Grupo/ListarQueuexGrupoSede', {
                    ID: this.ID,
                    ID_GRUPO: 18,
                    ID_USUARIO: this.ID_USUARIO,
                    ID_SEDE: this.ID_SEDE,
                }, configImg).then(response => {
                    if (response.data.length > 0) {
                        let lista = response.data;
                        let Pendiente = []; let Proceso = []; let Terminado = []; let Monitores = []; let Estudios = [];
                        Pendiente = lista.filter(x => x.ACCIONES == 'PENDIENTE');
                        Proceso = lista.filter(x => x.ACCIONES == 'PROCESO' || x.ACCIONES == 'AGENDADO' || x.ACCIONES == 'GRUPO');
                        Terminado = lista.filter(x => x.ACCIONES == 'TERMINADO');

                        map = new Map();
                        for (let i of Pendiente) {
                            if (!map.has(i.RESULTADO)) {
                                map.set(i.RESULTADO, true);
                                Estudios.push({ ESTUDIO: i.RESULTADO });
                            }
                        }           //  alert(JSON.stringify(`${lista[items].ESTADO}`));

                        let uno = []; let grupos = { INC: 0 }; let registros = { INC: 0 };    //alert(i.ESTUDIO);
                        for (let i of Estudios) {
                            grupos = {};
                            registros = {};
                            let filas = lista.filter(x => x.RESULTADO == i.ESTUDIO);
                            if (filas.length > 0) {
                                grupos['GRAFICA'] = filas.length; //registros[i.ESTUDIO] = filas.length;
                                grupos['ESTUDIO'] = i.ESTUDIO;
                                uno.push(grupos);
                            }
                        }

                        this.ListaPendiente = Pendiente;
                        this.ListaProceso = Proceso;
                        this.ListaGeneral.push({
                            PENDIENTE: Pendiente.length,
                            PROCESO: Proceso.length,
                            TERMINADO: Terminado.length,
                            TOTAL: lista.length,
                            MONITORES: Monitores.length,
                            ESTUDIOS: uno,
                            //ESTUDIOS: [
                            //    { ESTUDIO: "176 - TOYOTA VENTAS PERU", GRAFICA: { "NICOLAS": 33, "NANCY": 122 } },
                            //            { ESTUDIO: "175 - TOYOTA SERVICIOS PERU", GRAFICA: { "NICOLAS": 23, "NANCY": 10 } },
                            //    { ESTUDIO: "63 - IPSOS BCP_PYME SIN CARTERAS", GRAFICA: { "NICOLAS": 3, "NANCY": 2 } }]
                        });
                    }
                }).catch(e => { this.mostrarToast({ toast: 'warning', msg: 'Error en la conexión ... 2' }); });
            },

            listarItems: function () {
                //axios.defaults.headers.common['Authorization'] = 'Bearer ' + this.token;
                axios.post('@apiServidor' + '/api/Helpers/ListarItems', {
                    ID_GRUPO: 16,
                }, configImg).then(response => {
                    if (response.data.length > 0) {
                        this.ListaItems = response.data;        //alert(JSON.stringify(lista));
                        this.ListaItems_ = response.data;
                        this.ListaArea = this.ListaItems_.filter(x => x.ID_CONTROL == 1);
                        this.ListaPlanTrabajo = this.ListaItems_.filter(x => x.ID_CONTROL == 2);
                        this.ListaMotivo = this.ListaItems_.filter(x => x.ID_CONTROL == 3);
                        this.ListaProcedimiento = this.ListaItems_.filter(x => x.ID_CONTROL == 4);
                        this.ListaComplejidad = this.ListaItems_.filter(x => x.ID_CONTROL == 5);
                        this.ListaEstado = this.ListaItems_.filter(x => x.ID_CONTROL == 7);
                        let lista = this.ListaItems_.filter(x => x.ID_CONTROL == 8);
                        let listaCuadros = this.ListaItems_.filter(x => x.ID_CONTROL == 9);

                        for (i in lista) {
                            this.ListaGNC.push({ ID: lista[i].ID, TITULO: lista[i].TITULO, ID_CONTROL: lista[i].ID_CONTROL, STATUS: 0 });
                        }
                        let inc = 0;
                        for (i in listaCuadros) {
                            inc = inc + 1;
                            this.ListaCuadrosAsociados.push({ ID: inc, TITULO: listaCuadros[i].TITULO, VALUE_: '', VALUE: 0, STATUS: 0 });
                        }
                    } else {
                        this.mostrarToast({ toast: 'warning', msg: 'Usuario incorrecto ...' });
                    }
                }).catch(e => { });
            },

            cargarDropdow: function () {         //alert(JSON.stringify(item));
                //alert(this.ESTADO);
                this.ListaSubEstado = [];
                this.SUB_ESTADO = 'SELECCIONAR';
                switch (this.ESTADO) {
                    case 'RECHAZADO': {
                        this.ListaSubEstado.push(
                            { ID: 1, TITULO: 'CARENCIA' },
                            { ID: 2, TITULO: 'COBERTURA' },

                            { ID: 3, TITULO: 'T.E 12 meses CX' },
                            { ID: 4, TITULO: 'T.E.12 meses procedimientos médicos' },
                            { ID: 5, TITULO: 'T.E 12 meses terapía física' },
                            { ID: 6, TITULO: 'T.E. 6 meses hospitalización' },
                            { ID: 7, TITULO: 'T.E 6 meses preexistencia' },
                            { ID: 8, TITULO: 'T.E 12 meses chequeo médico' },
                            { ID: 9, TITULO: 'T.E 12 meses enfermedades congénitas' },
                            { ID: 10, TITULO: 'T.E 12 meses maternidad' });


                            //{ ID: 3, TITULO: 'PERTINENCIA' },
                            //{ ID: 4, TITULO: 'POLÍTICA' });
                        break;
                    }
                    case 'DEVUELTO': {
                        this.ListaSubEstado.push(
                            { ID: 1, TITULO: 'DUPLICIDAD' },
                            { ID: 2, TITULO: 'CAMBIO DE SEDE' },
                            { ID: 3, TITULO: 'NO REQUIERE LA ATENCIÓN' },
                            { ID: 4, TITULO: 'PERTINENCIA MÉDICA' },
                            { ID: 5, TITULO: 'POLÍTICA' } );
                            //{ ID: 4, TITULO: 'CUOTA IMPAGA' });
                        break;
                    }
                }
            },

            listarCoberturas: async function () {
                if (this.SEDE.length > 1) {
                    await axios.post(this.SERVER_API + '/api/CartaGarantia/ObtenerCodigoCobertura', {
                        PLAN: this.COD_PLAN,
                        CONTRATO: this.CONTRATO,
                    }, configImg).then(response => {
                        alert(response.data.COD);
                        this.listarCoberturas_2(response.data.COD);
                    }).catch(e => { });
                } else {
                    this.listarSedes();
                }
            },

            listarCoberturas_2: async function (codigo) {
                    let url = (this.GRUPO == 'ONCOLOGICO') ? '/api/CartaGarantia/ListarCoberturaContrato' : '/api/CartaGarantia/ListarCoberturas';
                    await axios.post(this.SERVER_API + url, {
                        PLAN: codigo, //this.COD_PLAN,
                        CONTRATO: this.CONTRATO,
                        SECUENCIA: this.COD_ASEGURADEP,
                        SUCURSAL: this.COD_SUCURSAL,
                        SEDE: this.COD_EMPRESA,   // this.SEDE,
                    }, configImg).then(response => {
                        if (response.data.length > 0) {
                            this.listaCoberturas = response.data;        //alert(JSON.stringify(lista));
                            this.listaCoberturas_ = response.data;

                            this.COBERTURA = '';
                            this.COPAGO = '';
                            this.DEDUCIBLE = '';
                            this.$bvModal.show('solicitarCobertura');
                        } else {
                            this.mostrarToast({ toast: 'warning', msg: 'No encontramos información ...' });
                        }
                    }).catch(e => { });
            },

            buscarCobertura: function (item) {
                if (this.CAMPO.length > 0) {
                    let palabra = this.CAMPO.toUpperCase();
                    this.listaCoberturas = this.listaCoberturas_.filter(x => {
                        return x.COBERTURA.includes(palabra);
                    });
                }
                else {
                    this.listaCoberturas = this.listaCoberturas_;
                }
            },

            elegirCobertura: function (item) {
                this.COBERTURA = item.COBERTURA;
                this.COPAGO = item.COPAGO;
                this.DEDUCIBLE = item.DEDUCIBLE;
                this.listaCoberturas = [];
                this.listaCoberturas_ = [];

                if (this.COPAGO.length > 0 && this.DEDUCIBLE.length > 3) {
                    axios.post(this.SERVER_API + '/api/CartaGarantia/InsertarCoberturaCarta', {
                        ID: 0,
                        ID_SOURCE: this.ID_SOURCE,
                        COBERTURA: item.COBERTURA,
                        COPAGO: item.COPAGO,
                        DEDUCIBLE: item.DEDUCIBLE,
                        GRUPO: item.GRUPO,
                        TIPO: 2,
                        ID_USUARIO: this.ID_USUARIO,
                    }, configImg).then(response => {
                        if (response.data.ID > 0) {
                            if (this.ID_COBERTURA > 0) {
                                this.eliminarCoberturaAgregada({ ID: this.ID_COBERTURA });
                                this.listarCoberturasAgregadas();
                            } else { this.listarCoberturasAgregadas(); }

                            this.$bvModal.hide('solicitarCobertura');
                        } else {
                            this.mostrarToast({ toast: 'warning', msg: 'No encontramos información ...' });
                        }
                    }).catch(e => { });
                }
                this.CAMPO = '';
            },

            listarCoberturasAgregadas: async function () {
                this.listaCoberturasAgregadas = [];
                await axios.post(this.SERVER_API + '/api/CartaGarantia/ListarCoberturasAgregadas', {
                    ID: this.ID_SOURCE,
                }, configImg).then(response => {
                    if (response.data.length > 0) {
                        this.listaCoberturasAgregadas = response.data;
                    }
                }).catch(e => { });
            },

            eliminarCoberturaAgregada: function (item) {
                axios.post(this.SERVER_API + '/api/CartaGarantia/InsertarCoberturaCarta', {
                    ID: item.ID,
                    TIPO: 3,
                    ID_USUARIO: this.ID_USUARIO,
                }, configImg).then(response => {
                    if (response.data.ID > 0) {
                        this.listarCoberturasAgregadas();
                    } else {
                        this.mostrarToast({ toast: 'warning', msg: 'No encontramos información ...' });
                    }
                }).catch(e => { });
            },

            editarCoberturaAgregada: function (item) {
                this.$bvModal.show('solicitarCobertura');
            },

            listarProcedimientos: function () {
                axios.post(this.SERVER_API + '/api/CartaGarantia/ListarProcedimientos', {
                    PROCEDIMIENTO: this.PROCEDIMIENTO,
                }, configImg).then(response => {
                    if (response.data.length > 0) {
                        this.ListaProcedimiento = response.data;        //alert(JSON.stringify(lista));
                        this.ListaProcedimiento_ = response.data;
                        this.$bvModal.show('solicitarProcedimiento');
                    } else {
                        this.mostrarToast({ toast: 'warning', msg: 'No encontramos información ...' });
                    }
                }).catch(e => { });
            },

            listarPrexistencias: async function () {
                if (this.COD_ASEGURADEP.length > 0 && this.SEC_CONTRATO.length > 0) {
                    await axios.post(this.SERVER_API + '/api/CartaGarantia/ListarPrexistencias', {
                        ID_SOURCE: this.ID_SOURCE,
                        NUM_CONTRATO: this.CONTRATO.replace(' ', ''),
                        SEC_CONTRATO: this.SEC_CONTRATO,
                        SEC_ASEGURADO: this.COD_ASEGURADEP,
                    }, configImg).then(response => {
                        if (response.data.length > 0) {
                            this.ListaPrexistencia = response.data;        //alert(JSON.stringify(lista));
                            this.$bvModal.show('solicitarPrexistencia');
                        }
                    }).catch(e => { });
                }
            },

            listarCartasAprobadas: async function () {
                if (this.NRO_DOCUMENTO.length > 0) {
                    await axios.post(this.SERVER_API + '/api/CartaGarantia/ListarCartasAprobadasSedes', {
                        ID_SOURCE: this.ID_SOURCE,
                        AFILIADO: this.NRO_DOCUMENTO.replace(' ', ''),

                    }, configImg).then(response => {
                        if (response.data.length > 0) {
                            this.ListaCartasAprobadas = response.data;        //alert(JSON.stringify(lista));
                            this.$bvModal.show('solicitarPrexistencia');
                        }
                    }).catch(e => { });
                }
            },

            buscarProcedimiento: function (item) {
                if (this.CAMPO.length > 0) {
                    let palabra = this.CAMPO.toUpperCase();
                    this.ListaProcedimiento = this.ListaProcedimiento_.filter(x => {
                        return x.PROCEDIMIENTO.includes(palabra);
                    });
                }
                else {
                    this.ListaProcedimiento = this.ListaProcedimiento_;
                }
            },

            elegirProcedimiento: function (item) {
                this.PROCEDIMIENTO = item.PROCEDIMIENTO;
                this.COD_TARIFARIO = item.COD_TARIFARIO;
                this.ListaProcedimiento = [];
                this.ListaProcedimiento_ = [];
                this.CAMPO = '';
                this.stateProcedimiento = true;
                this.$bvModal.hide('solicitarProcedimiento');
            },

            listarSedes: function () {
                axios.post('@apiServidor' + '/api/CartaGarantia/ListarSedes', {
                }, configImg).then(response => {
                    if (response.data.length > 0) {
                        this.ListaSedes = response.data;
                        this.$bvModal.show('solicitarSede');
                    } else {
                        this.mostrarToast({ toast: 'warning', msg: 'No encontramos información ...' });
                    }
                }).catch(e => { });
            },

            verDetalle: function () {
                axios.post('@apiServidor' + '/api/CartaGarantia/ListarCartaDetalle', {
                    ID: this.ID_SOURCE,
                }, configImg).then(response => {
                    if (response.data.length > 0) {
                        this.ListaCartaDetalle = response.data;
                        this.$bvModal.show('solicitarCartaDetalle');
                    } else {
                        this.mostrarToast({ toast: 'warning', msg: 'No encontramos información ...' });
                    }
                }).catch(e => { });
            },

            elegirSede: function (item) {
                this.COD_EMPRESA= item.COD_EMPRESA;
                this.COD_SUCURSAL= item.COD_SUCURSAL;
                this.SEDE = item.SEDE;
                this.$bvModal.hide('solicitarSede');
                this.listarCoberturas();
            },

            onContext(ctx) {
                this.stateFecHospital = false;
                this.stateFecSolicitud = false;
                if (this.FEC_HOSPITAL.length > 2) { this.stateFecHospital = true; } else { this.stateFecHospital = false; }
                if (this.FEC_SOLICITUD.length > 2) { this.stateFecSolicitud = true; } else { this.stateFecSolicitud = false; }
            },

            limpiarSede: function () {
                this.COD_EMPRESA = '';
                this.COD_SUCURSAL = '';
                this.SEDE = '';

                this.COBERTURA = '';
                this.COPAGO = '';
                this.DEDUCIBLE = '';
                this.listarSedes();
            },

            darPrioridad: function (item) {
                var opcion = confirm("Deseas asignar prioridad al afiliado - " + item.TITULO + " con carta N° " + item.RESULTADO);
                if (opcion == true) {
                    axios.post(this.SERVER_API + '/api/Grupo/PrioridadQueuexGrupoSede', {
                        ID: item.ID,
                        ID_USUARIO: this.ID_USUARIO,
                        ID_SEDE: this.ID_SEDE,
                    }, configImg).then(response => {
                        if (response.data.ID > 0) {
                            this.listarGraficoGeneral();
                            ;                            //this.ListaProceso = this.ListaProceso.filter(x => x.ID != item.ID);
                        }
                    }).catch(e => { this.mostrarToast({ toast: 'warning', msg: 'Error en la conexión ... 2' }); });

                } else { this.mostrarToast({ toast: 'warning', msg: 'Cancelado por el usuario' }); }
            },

            retirarPrioridad: function(item) {
                var opcion = confirm("Deseas retirar prioridad al afiliado - " + item.TITULO + " con carta N° " + item.RESULTADO);
                if (opcion == true) {
                    axios.post(this.SERVER_API + '/api/Grupo/EliminarPrioridadQueuexGrupoSede', {
                        ID: item.ID,
                        ID_USUARIO: this.ID_USUARIO,
                        ID_SEDE: this.ID_SEDE,
                    }, configImg).then(response => {
                        if (response.data.ID > 0) {
                            this.listarGraficoGeneral();
                            //this.ListaProceso = this.ListaProceso.filter(x => x.ID != item.ID);
                        }
                    }).catch(e => { this.mostrarToast({ toast: 'warning', msg: 'Error en la conexión ... 2' }); });

                } else { this.mostrarToast({ toast: 'warning', msg: 'Cancelado por el usuario' }); }
            },

            AgregarItem: function (i) {
                if (this.CAMPO.length > 2) {
                    this.INC = this.INC + 1;

                    this.CAMPO = this.CAMPO.toUpperCase();
                    axios.post(this.SERVER_API + '/api/Helpers/AdministrarItems', {
                        ID: 0,
                        ID_GRUPO: 16,
                        ID_CONTROL: i.idControl,
                        ID_PADRE: 0,
                        TITULO: this.CAMPO,
                        DETALLE: '',
                        CAMPO1: '',
                        CAMPO2: '',
                        CAMPO3: '',
                        ID_USUARIO: this.ID_USUARIO,
                    }, configImg).then(response => {
                        if (response.data.ID > 0) {
                            if (i.idControl = 8) {
                                this.ListaGNC.push({ ID: this.INC, TITULO: this.CAMPO, ID_CONTROL: 8, STATUS: 1 });
                                this.ListaGNCCheck.push({ INC: this.INC, ID: this.INC, TITULO: this.CAMPO });
                                this.copiarPortaPapeles();
                            } else {
                                this.ListaCuadrosAsociados.push({ ID: this.INC, TITULO: this.CAMPO, VALUE: 0 });
                            }
                            this.mostrarToast({ toast: 'success', msg: 'Hola ' + this.USUARIO + ', se agregó correctamente el nuevo GNC. ' });
                        }
                    }).catch(e => {
                    });
                } else { this.mostrarToast({ toast: 'warning', msg: 'Hola ' + this.USUARIO + ', asegurate de agregar un nuevo GNC valido. ' }); }
            },

            AgregarListaGNC: function (item) {
                //this.EliminarListaGNC({ ID: item.ID });  // Limpiar
                this.INC = this.INC + 1;
                for (let i in this.ListaGNC) {
                    if (this.ListaGNC[i].ID == item.ID) {
                        this.ListaGNC[i].STATUS = 1;
                        this.ListaGNCCheck.push({ INC: this.INC, ID: this.ListaGNC[i].ID, TITULO: this.ListaGNC[i].TITULO });
                    }
                }
                this.copiarPortaPapeles();
            },

            EliminarListaGNC: function (item) {
                let listaTemporal = this.ListaGNCCheck;
                this.ListaGNCCheck = listaTemporal.filter(x => x.ID != item.ID);
                for (let i in this.ListaGNC) {
                    if (this.ListaGNC[i].ID == item.ID) {
                        this.ListaGNC[i].STATUS = 0;
                    }
                }
                this.copiarPortaPapeles();
            },

            copiarPortaPapeles: function () {
                let item = '\n';
                if (this.ListaGNCCheck.length > 0) {
                    item = ''; let salto = '\r\n'; let index = 0;
                    for (let i in this.ListaGNCCheck) {
                        index = index + 1;
                        if (i == 0) {
                            item = index + '.- ' + this.ListaGNCCheck[i].TITULO + salto;
                        } else if (i == this.ListaGNCCheck.length - 1) {
                            item = item + index + '.- ' + this.ListaGNCCheck[i].TITULO;
                        } else {
                            item = item + index + '.- ' + this.ListaGNCCheck[i].TITULO + salto;
                        }
                    }
                }
                var textarea = document.createElement('textarea');
                textarea.textContent = item; //'coppied text x Mario';
                document.body.appendChild(textarea);

                var selection = document.getSelection();
                var range = document.createRange();
                range.selectNodeContents(textarea);
                selection.removeAllRanges();
                selection.addRange(range);

                console.log(selection.getRangeAt(0).cloneContents());
                console.log('Supported', document.queryCommandSupported('copy'));
                console.log('Enabled', document.queryCommandEnabled('copy'));
                console.log('copy success', document.execCommand('copy'));
                selection.removeAllRanges();
                document.body.removeChild(textarea);
            },

            verAdicionales: async function () {
                this.ListaAdicionales = [];
                await axios.post('@apiServidor' + '/api/CartaGarantia/ListarAdicionales', {
                    ID: this.ID_SOURCE,
                }, configImg).then(response => {
                    if (response.data.length > 0) {
                        this.ListaAdicionales = response.data;
                    }
                }).catch(e => { });
            },

            verCuadrosAsociados: async function () {
                let listaItems = this.ListaCuadrosAsociados;
                this.LIM_CARTA_DIFERENCIA = 0; this.LIM_CARTA_APROBADA = 0;
                this.LIMITE_CG = (parseFloat(this.LIMITE_CG)).toFixed(2);
                await axios.post('@apiServidor' + '/api/CartaGarantia/ListarCuadrosAsociados', {
                    ID_SOURCE: this.ID_SOURCE,
                }, configImg).then(response => {
                    if (response.data.length > 0) {
                        let listaCuadros = response.data;
                        for (i in listaItems) {
                            for (y in listaCuadros) {
                                if (listaItems[i].ID == listaCuadros[y].ID) {
                                    listaItems = listaItems.filter(x => x.ID != listaCuadros[y].ID);
                                    listaItems.push({ ID: listaCuadros[y].ID, TITULO: listaCuadros[y].TITULO, VALUE_: listaCuadros[y].MONTO, VALUE: listaCuadros[y].MONTO, STATUS: 1 });
                                }
                            }
                        }
                        this.ListaCuadrosAsociados = listaItems;
                        for (i in this.ListaCuadrosAsociados) {
                            let val = this.ListaCuadrosAsociados[i].VALUE;
                            if (val > 0) {
                                this.LIM_CARTA_DIFERENCIA = (parseFloat(this.LIM_CARTA_DIFERENCIA) + parseFloat(val)).toFixed(2);
                            }
                            this.LIM_CARTA_APROBADA = (parseFloat(this.LIMITE_CG) - parseFloat(this.LIM_CARTA_DIFERENCIA)).toFixed(2);
                        }
                    } else {
                        this.LIM_CARTA_APROBADA = this.LIMITE_CG;
                    }
                }).catch(e => { });
            },

            AdmCuadrosAsociados: function (item) {
                this.LIM_CARTA_DIFERENCIA = 0; this.LIM_CARTA_APROBADA = 0;
                this.LIMITE_CG = (parseFloat(this.LIMITE_CG)).toFixed(2);
                let monto = item.VALUE.replace('.', ',');
                axios.post(this.SERVER_API + '/api/CartaGarantia/AdmCuadrosAsociados', {
                    ID: item.ID,
                    ID_SOURCE: this.ID_SOURCE,
                    TITULO: item.TITULO,
                    MONTO: monto, //item.VALUE,
                    ID_USUARIO: this.ID_USUARIO,
                    STATUS: item.STATUS,
                }, configImg).then(response => {
                    if (response.data.ID > 0) {
                        this.ListaCuadrosAsociados = this.ListaCuadrosAsociados.filter(x => x.ID != item.ID);
                        this.ListaCuadrosAsociados.push({ ID: response.data.ID, TITULO: item.TITULO, VALUE_: item.VALUE_, VALUE: item.VALUE, STATUS: item.STATUS });

                        for (i in this.ListaCuadrosAsociados) {
                            let val = this.ListaCuadrosAsociados[i].VALUE;
                            if (val > 0) {
                                this.LIM_CARTA_DIFERENCIA = (parseFloat(this.LIM_CARTA_DIFERENCIA) + parseFloat(val)).toFixed(2);
                            }
                            this.LIM_CARTA_APROBADA = (parseFloat(this.LIMITE_CG) - parseFloat(this.LIM_CARTA_DIFERENCIA)).toFixed(2);
                        }
                        this.verSiniestros();
                    }
                }).catch(e => {
                });
            },
        }
    })


    app.listarItems();
    app.listarGraficoGeneral();
    app.grafico();

</script>
